import{a as q}from"./chunk-Z3UO65U3.js";import"./chunk-OWTGQR6U.js";import"./chunk-MB5UDTNQ.js";import{a as Oe,b as Be}from"./chunk-IZUVX76I.js";import{b as xe}from"./chunk-7PIM7VCW.js";import{a as Ie}from"./chunk-GSMGX6RX.js";import{a as Fe,b as Le}from"./chunk-7LKCTRLS.js";import"./chunk-MEVQH5BX.js";import{A as Ue,B as Ve,C as ke,D as Pe,F as j,i as Ce,j as be,l as ye,m as we,p as Se,q as De,v as N,w as Te,x as Me,y as Ee}from"./chunk-DNVA5LVB.js";import{b as O,c as ce}from"./chunk-UQQFQ63C.js";import{$b as L,$c as fe,Ba as f,C as Z,Ca as _,D as U,Da as s,Ec as he,Fc as B,G as g,Ga as ee,Gc as R,H as V,Hc as ve,I as k,Ia as te,Ic as W,Ja as ie,Ka as ne,La as K,Ma as a,Na as y,Nb as J,O as c,Oa as D,P as p,Qa as w,Ra as x,Sa as S,Sb as se,T as A,Ua as oe,Va as E,Wa as G,_c as ge,a as X,aa as m,cb as I,d as Q,db as T,ha as M,hc as pe,ka as C,lc as me,ma as d,pa as $,qb as re,sb as le,sc as de,uc as ue,va as r,vb as P,vc as _e,wa as o,xa as b,xb as F,z as Y,zb as ae}from"./chunk-E4UPHNBD.js";import"./chunk-WWX6BADO.js";var Re=(()=>{class n{constructor(){this.http=g(ae),this.api=g(ce),this.notificationService=g(O),this.dateService=g(Ie),this.host=this.api.host,this.deliverForm=M(this.resetDeliverForm()),this.deliverInvoice=new Q([]),this.invoiceTotal=new Q(0),this.checkoutLoading=M(!1),this.users=M([]),this.usersLoading=M(!1),this.getUsers()}calculateTotal(){let e=this.deliverInvoice.value;this.invoiceTotal.next(e.reduce((i,t)=>i+t.quantity*t.unit_price,0))}resetDeliverForm(){return{database_id:null,order_datetime:this.dateService.getCurrentDate(),total_price:0,notes:null}}checkout(e,i){this.checkoutLoading.set(!0),this.http.post(`${this.host}/deliver/invoice`,{order:e,items:i}).subscribe({next:t=>{this.notificationService.showSuccess(t.message,"home"),this.deliverInvoice.next([]),this.deliverForm.set(this.resetDeliverForm()),this.checkoutLoading.set(!1)},error:t=>{this.notificationService.handleError(t.error,"home"),this.checkoutLoading.set(!1)}})}getUsers(){this.usersLoading.set(!0),this.http.get(`${this.host}/user-deliver/users`).subscribe({next:e=>{this.users.set(e),this.usersLoading.set(!1)},error:e=>{this.usersLoading.set(!1),this.notificationService.handleError(e.error,"users")}})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=Z({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Qe=["tableSearch"],Ae=()=>({width:"75vw"}),Ke=()=>({"1199px":"85vw","575px":"95vw"}),Ge=()=>["product_name"],Je=()=>[10,15,50,100];function Xe(n,u){n&1&&(r(0,"tr")(1,"th",14),b(2,"p-tableHeaderCheckbox"),o(),r(3,"th",15),a(4," Description"),b(5,"p-sortIcon",16),o(),r(6,"th",17),a(7," Category"),b(8,"p-sortIcon",18),o(),r(9,"th"),a(10,"Price"),o()())}function Ye(n,u){if(n&1&&(r(0,"tr",19)(1,"td"),b(2,"p-tableCheckbox",20),o(),r(3,"td"),a(4),o(),r(5,"td"),a(6),o(),r(7,"td"),a(8),I(9,"currency"),o()()),n&2){let e=u.$implicit;d("pSelectableRow",e),m(2),d("pSelectableRow",e)("value",e),m(2),y(e.product_name),m(2),y(e.category_name||"---"),m(2),y(T(9,6,e.unit_cost_usd))}}function Ze(n,u){if(n&1){let e=f();r(0,"div",5)(1,"div",6)(2,"span",7),b(3,"i",8),r(4,"input",9,0),_("input",function(t){c(e);let l=K(10);return p(l.filterGlobal(t.target.value,"contains"))}),o()()(),r(6,"div",6)(7,"h3",10),a(8),o()()(),r(9,"p-table",11,1),S("selectionChange",function(t){c(e);let l=s();return x(l.selectedProducts,t)||(l.selectedProducts=t),p(t)}),_("onRowSelect",function(){c(e);let t=s();return p(t.selectInput())})("onRowUnselect",function(){c(e);let t=s();return p(t.selectInput())}),C(11,Xe,11,0,"ng-template",12)(12,Ye,10,8,"ng-template",13),o()}if(n&2){let e=K(10),i=s();m(4),d("value",e.filters.global==null?null:e.filters.global.value),m(4),D(" Total Selected: ",i.selectedProducts.length," "),m(),d("value",i.products()),w("selection",i.selectedProducts),d("loading",i.tableLoading())("globalFilterFields",E(12,Ge))("filterDelay",0)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",E(13,Je))("alwaysShowPaginator",!0)}}function $e(n,u){if(n&1){let e=f();r(0,"h3",21),a(1),o(),r(2,"p-button",22),_("onClick",function(){c(e);let t=s();return p(t.closeDialog())}),o(),r(3,"p-button",23),_("onClick",function(){c(e);let t=s();return p(t.submitProducts())}),o()}if(n&2){let e=s();m(),D(" Total Selected: ",e.selectedProducts.length," "),m(2),d("disabled",e.selectedProducts.length==0)}}var z=(()=>{class n{constructor(){this.stockService=g(q),this.visible=!1,this.onSubmit=new A,this.onHide=new A,this.products=this.stockService.getProducts(),this.tableLoading=this.stockService.tableLoading,this.selectedProducts=[]}ngOnInit(){}submitProducts(){this.onSubmit.emit(this.selectedProducts),this.closeDialog()}closeDialog(){this.selectedProducts=[],this.onHide.emit(!1)}selectInput(){this.tableSearch.nativeElement.select()}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=V({type:n,selectors:[["user-deliver-dialog"]],viewQuery:function(i,t){if(i&1&&te(Qe,5),i&2){let l;ie(l=ne())&&(t.tableSearch=l.first)}},inputs:{visible:"visible"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},standalone:!0,features:[oe],decls:3,vars:10,consts:[["tableSearch",""],["dt",""],["header","Select Items","styleClass","p-fluid",3,"visibleChange","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[1,"grid","mb-2"],[1,"col-6"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","search","placeholder","Search ...",1,"p-inputtext-sm",3,"input","value"],[1,"text-center","m-0"],["selectionMode","multiple","dataKey","product_id","styleClass","p-datatable-sm","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} records",3,"selectionChange","onRowSelect","onRowUnselect","value","selection","loading","globalFilterFields","filterDelay","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator"],["pTemplate","header"],["pTemplate","body"],[2,"width","4rem"],["pSortableColumn","product_name"],["field","product_name"],["pSortableColumn","category_name"],["field","category_name"],[3,"pSelectableRow"],[3,"pSelectableRow","value"],[1,"text-left","m-0"],["label","Cancel","icon","pi pi-times","severity","secondary","size","small",3,"onClick"],["label","Finish","icon","pi pi-check","severity","success","size","small",3,"onClick","disabled"]],template:function(i,t){i&1&&(r(0,"p-dialog",2),S("visibleChange",function(h){return x(t.visible,h)||(t.visible=h),h}),C(1,Ze,13,14,"ng-template",3)(2,$e,4,2,"ng-template",4),o()),i&2&&($(E(8,Ae)),d("modal",!0),w("visible",t.visible),d("breakpoints",E(9,Ke))("closeOnEscape",!1)("closable",!1)("maximizable",!0))},dependencies:[j,N,L,Te,Ee,Me,ke,Pe,R,B,fe,ge,F,P,W,ve]})}}return n})();var tt=n=>({"ng-invalid ng-dirty":n}),it=n=>({invalid:n});function nt(n,u){n&1&&(r(0,"small",25),a(1,"User is required."),o())}function ot(n,u){n&1&&(r(0,"tr")(1,"th",26),a(2,"#"),o(),r(3,"th",27),a(4,"Description"),o(),r(5,"th",28),a(6,"Unit"),o(),r(7,"th",29),a(8,"Qty"),o(),r(9,"th",28),a(10,"Total"),o(),r(11,"th",26),a(12,"Del?"),o()())}function rt(n,u){if(n&1){let e=f();r(0,"p-inputNumber",35),S("ngModelChange",function(t){c(e);let l=s().$implicit;return x(l.quantity,t)||(l.quantity=t),p(t)}),_("onFocus",function(t){c(e);let l=s(2);return p(l.select(t.target))})("ngModelChange",function(){c(e);let t=s().$implicit,l=s();return p(l.setQty(t))}),o()}if(n&2){let e=s().$implicit;w("ngModel",e.quantity)}}function lt(n,u){if(n&1&&a(0),n&2){let e=s().$implicit;D(" ",e.quantity," ")}}function at(n,u){if(n&1){let e=f();r(0,"tr")(1,"td"),a(2),o(),r(3,"td"),a(4),o(),r(5,"td"),a(6),I(7,"currency"),o(),r(8,"td",30)(9,"p-cellEditor"),C(10,rt,1,1,"ng-template",31)(11,lt,1,1,"ng-template",32),o()(),r(12,"td"),a(13),I(14,"currency"),o(),r(15,"td",33),_("click",function(){let t=c(e).rowIndex,l=s();return p(l.removeRow(t))}),b(16,"i",34),o()()}if(n&2){let e=u.$implicit,i=u.rowIndex;m(2),y(i+1),m(2),y(e.product_name),m(2),y(T(7,6,e.unit_price)),m(2),d("pEditableColumn",e.quantity)("ngClass",G(10,it,!e.quantity)),m(5),D(" ",T(14,8,e.unit_price*e.quantity)," ")}}function st(n,u){}function ct(n,u){n&1&&(r(0,"tr",36)(1,"td",37),a(2,"No data yet!"),o()())}function pt(n,u){if(n&1){let e=f();r(0,"p-autoComplete",38,1),S("ngModelChange",function(t){c(e);let l=s();return x(l.search_product,t)||(l.search_product=t),p(t)}),_("completeMethod",function(t){c(e);let l=s();return p(l.searchItem(t))})("onKeyUp",function(t){c(e);let l=s();return p(l.submitInvoiceInput(t))}),o(),r(2,"button",39),_("click",function(){c(e);let t=s();return p(t.openProductsDialog())}),o()}if(n&2){let e=s();w("ngModel",e.search_product),d("suggestions",e.matching_products)("delay",150)("autofocus",!0)}}function mt(n,u){if(n&1){let e=f();r(0,"p-button",40),_("onClick",function(){c(e);let t=s();return p(t.clearInvoice())}),o(),r(1,"p-button",41),_("onClick",function(){c(e);let t=s();return p(t.checkout())}),o()}if(n&2){let e=s();d("disabled",e.deliverInvoice.length===0||e.checkoutLoading()),m(),d("disabled",e.deliverInvoice.length===0||!e.deliverForm().database_id)("loading",e.checkoutLoading())}}var We=(()=>{class n{constructor(){this.deliverService=g(Re),this.stockService=g(q),this.notificationService=g(O),this.confirmationService=g(se),this.vh=75,this.dialogVisible=!1,this.products=this.stockService.products,this.users=this.deliverService.users,this.userInvalid=!1,this.checkoutLoading=this.deliverService.checkoutLoading,this.deliverForm=this.deliverService.deliverForm,this.search_product=null,this.matching_products=[],this.subscriptions=new X}ngOnInit(){this.subscriptions.add(this.deliverService.deliverInvoice.pipe(Y(e=>{this.deliverService.calculateTotal()})).subscribe(e=>{this.deliverInvoice=e})),this.subscriptions.add(this.deliverService.invoiceTotal.subscribe(e=>{this.invoiceTotal=e}))}ngOnDestroy(){this.subscriptions.unsubscribe()}searchItem(e){let i=this.products(),t=[],l=e.query;for(let h=0;h<i.length;h++){let v=i[h];v.product_name.toLowerCase().indexOf(l.toLowerCase())>-1&&t.push(v)}this.matching_products=t}submitInvoiceInput(e){e.key==="Enter"&&(typeof this.search_product=="object"&&this.search_product!==null?this.addProduct(this.search_product):this.search_product&&this.notificationService.showError("Product not found","home"),this.search_product=null)}addProduct(e){let i=this.deliverInvoice.findIndex(t=>t.product_id===e.product_id);i!==-1?(this.deliverInvoice[i].quantity+=1,this.deliverService.deliverInvoice.next(this.deliverInvoice)):this.deliverService.deliverInvoice.next([...this.deliverInvoice,{product_id:e.product_id,product_name:e.product_name,quantity:1,unit_price:e.unit_cost_usd}])}openProductsDialog(){this.dialogVisible=!0}closeProductsDialog(){this.dialogVisible=!1}assignSelectedProducts(e){this.dialogVisible=!1,e.forEach(i=>{this.addProduct(i)})}validate(){this.userInvalid=!1}select(e){e.select()}setPrice(e){e.unit_price,this.deliverService.calculateTotal()}setQty(e){this.deliverService.calculateTotal()}removeRow(e){let i=this.deliverInvoice;this.deliverService.deliverInvoice.next([...i.slice(0,e),...i.slice(e+1)])}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.deliverService.deliverInvoice.next([]),this.deliverService.deliverForm.set(this.deliverService.resetDeliverForm())}})}checkout(){console.log(this.deliverService.deliverForm());let e=0;this.deliverInvoice.forEach(i=>{(i.unit_price==0||!i.unit_price)&&(this.notificationService.showError(`${i.product_name} cannot be 0.00$`,"home"),e++),(i.quantity==0||!i.quantity)&&(this.notificationService.showError(`${i.product_name} Quantity cannot be 0`,"home"),e++)}),e===0&&this.confirmationService.confirm({key:"home",message:'Are you sure that you want to continue"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.deliverForm().total_price=this.invoiceTotal,this.deliverService.checkout(this.deliverForm(),this.deliverInvoice)}})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=V({type:n,selectors:[["user-deliver"]],decls:36,vars:21,consts:[["invoiceTable",""],["barcodeInput",""],[1,"grid","m-1"],[1,"col-12","md:col-6"],["styleClass","p-0"],[1,"grid"],[1,"field"],[1,"flex","flex-column","gap-2"],["for","order_datetime"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small",3,"ngModelChange","ngModel","readonlyInput","iconDisplay","showIcon"],["for","user"],["styleClass","p-inputtext-sm w-full","id","user","appendTo","body","optionLabel","database_name","optionValue","database_id","placeholder","Select User","filterBy","database_name",1,"ng-invalid","ng-dirty",3,"ngModelChange","onChange","ngModel","options","filter","showClear","autoOptionFocus","ngClass"],["class","p-error",4,"ngIf"],[1,"text-center","mt-0","mb-0","lg:mt-4","lg:mb-4"],[1,"text-green-500"],[1,"col-12"],["dataKey","product_id_fk","styleClass","p-datatable-sm p-datatable-gridlines mt-3",3,"value","scrollable","scrollHeight","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],["pTemplate","emptymessage"],["styleClass","mt-2 p-2"],["pTemplate","left"],["pTemplate","right"],[3,"onHide","onSubmit","visible"],[1,"p-error"],["width","5%"],["width","40%"],["width","20%"],["width","10%"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["min","1","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],[1,"surface-300"],["colspan","6"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],["label","Clear","icon","pi pi-times","size","small","severity","danger","styleClass","mr-2",3,"onClick","disabled"],["label","Checkout","icon","pi pi-cart-plus","size","small","severity","success",3,"onClick","disabled","loading"]],template:function(i,t){if(i&1){let l=f();r(0,"div",2)(1,"div",3)(2,"p-card",4)(3,"div",5)(4,"div",3)(5,"div",6)(6,"div",7)(7,"label",8),a(8,"Invoice Date"),o(),r(9,"p-calendar",9),S("ngModelChange",function(v){return c(l),x(t.deliverForm().order_datetime,v)||(t.deliverForm().order_datetime=v),p(v)}),o()()()(),r(10,"div",3)(11,"div",6)(12,"div",7)(13,"label",10),a(14,"User"),o(),r(15,"p-dropdown",11),S("ngModelChange",function(v){return c(l),x(t.deliverForm().database_id,v)||(t.deliverForm().database_id=v),p(v)}),_("onChange",function(){return c(l),p(t.validate())}),o(),C(16,nt,2,0,"small",12),o()()()()()(),r(17,"div",3)(18,"p-card")(19,"h1",13)(20,"span",14),a(21,"Total: "),o(),a(22),I(23,"currency"),o()()(),r(24,"div",15)(25,"p-card")(26,"p-table",16,0),C(28,ot,13,0,"ng-template",17)(29,at,17,12,"ng-template",18)(30,st,0,0,"ng-template",19)(31,ct,3,0,"ng-template",20),o(),r(32,"p-toolbar",21),C(33,pt,3,4,"ng-template",22)(34,mt,2,3,"ng-template",23),o()()()(),r(35,"user-deliver-dialog",24),_("onHide",function(){return c(l),p(t.closeProductsDialog())})("onSubmit",function(v){return c(l),p(t.assignSelectedProducts(v))}),o()}i&2&&(m(9),w("ngModel",t.deliverForm().order_datetime),d("readonlyInput",!0)("iconDisplay","input")("showIcon",!0),m(6),w("ngModel",t.deliverForm().database_id),d("options",t.users())("filter",!0)("showClear",!0)("autoOptionFocus",!1)("ngClass",G(19,tt,t.userInvalid)),m(),d("ngIf",t.userInvalid),m(6),D("",T(23,17,t.invoiceTotal)," "),m(4),ee("scrollHeight",t.vh),d("value",t.deliverInvoice)("scrollable",!0)("loading",t.checkoutLoading()),m(9),d("visible",t.dialogVisible))},dependencies:[re,le,pe,me,z,ue,L,he,B,N,Ue,Ve,Se,Ce,Fe,Oe,ye,P],styles:[".editable[_ngcontent-%COMP%]{width:100%;height:28px}[_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-width:0 0 1px;border-color:var(--red-500)!important}"]})}}return n})();var dt=[{path:"",component:We}],qe=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=k({type:n})}static{this.\u0275inj=U({imports:[J.forChild(dt),J]})}}return n})();var _i=(()=>{class n{static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275mod=k({type:n})}static{this.\u0275inj=U({imports:[F,de,qe,z,_e,R,j,De,be,xe,Le,Be,W,we]})}}return n})();export{_i as UserDeliverModule};
