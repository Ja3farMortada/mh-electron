import{b}from"./chunk-OWTGQR6U.js";import{a as g}from"./chunk-MB5UDTNQ.js";import{b as u,c as d}from"./chunk-SFMGPKFH.js";import{C as h,G as i,Hb as m,d as c,ha as s,zb as l}from"./chunk-E4UPHNBD.js";import{h as n}from"./chunk-WWX6BADO.js";var E=(()=>{class o{constructor(){this.http=i(l),this.router=i(m),this.notificationService=i(u),this.socket=i(g),this.userService=i(b),this.customers=s([]),this.selectedCustomer=s(null),this.customersTotalDebts$=s({id:0,balance:"0"}),this.customerDialogVisible=s(!1),this.newOrder$=new c(null),this.customerBalance$=new c([]),this.submitCustomerLoading=s(!1),this.signal_tableLoading=s(!1),this.signal_balanceLoading=s(!1),this.api=i(d),this.host=this.api.host,this.debts=s([]),this.debtsLoading=s(!1),this.getCustomers()}getDebts(){this.debtsLoading.set(!0),this.http.get(`${this.host}/customers/debts`).subscribe({next:t=>{this.debts.set(t),this.debtsLoading.set(!1)},error:t=>{this.notificationService.handleError(t.error,"home"),this.debtsLoading.set(!1)}})}getCustomers(){this.signal_tableLoading.set(!0),this.http.get(`${this.host}/customers`).subscribe({next:t=>{this.customers.set(t)},error:t=>{this.notificationService.handleError(t.error,"home"),this.signal_tableLoading.set(!1)},complete:()=>{this.signal_tableLoading.set(!1)}})}deleteCustomer(t){this.http.delete(`${this.host}/customers/${t.account_id}`).subscribe({next:e=>{this.customers.update(a=>{let r=this.customers().findIndex(f=>f.account_id===t.account_id);return a.splice(r,1),[...a]}),this.selectedCustomer.set(null),this.notificationService.showSuccess(e.message,"home")},error:e=>{this.notificationService.handleError(e.error,"home")}})}getCustomerBalance(t,e,a){this.submitCustomerLoading.set(!0),this.http.get(`${this.host}/customers/transactions/${t}&${e}&${a}`).subscribe({next:r=>{this.customerBalance$.next(r)},error:r=>{this.notificationService.handleError(r.error,"home"),this.submitCustomerLoading.set(!1)},complete:()=>{this.submitCustomerLoading.set(!1)}})}getAccountTotalBalance(t){return n(this,null,function*(){this.signal_balanceLoading.set(!0),yield this.http.get(`${this.host}/customers/${t}/balance`).subscribe({next:e=>n(this,null,function*(){yield this.customersTotalDebts$.set(e),console.log(e)}),error:e=>{this.notificationService.handleError(e.error,"home"),this.signal_balanceLoading.set(!1)},complete:()=>{this.signal_balanceLoading.set(!1)}})})}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=h({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{E as a};
