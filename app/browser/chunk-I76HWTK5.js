import{a as k}from"./chunk-UB2LRBS2.js";import{a as fe}from"./chunk-N5J4AUQI.js";import{a as ye,b as we}from"./chunk-IZUVX76I.js";import{b as pe}from"./chunk-7PIM7VCW.js";import{a as ue}from"./chunk-GSMGX6RX.js";import{a as Ce,b as be}from"./chunk-7LKCTRLS.js";import"./chunk-MEVQH5BX.js";import{A as he,B as ve,F as ge,i as le,j as ae,l as se,m as ce,p as me,q as de,v as _e}from"./chunk-DNVA5LVB.js";import{b as V,c as J}from"./chunk-UQQFQ63C.js";import{$b as G,Ba as f,C as L,Ca as v,D as S,Da as p,Ec as ie,Fc as ne,G as _,Ga as U,Gc as oe,H as j,I,Ic as re,Ma as a,Na as M,Nb as P,O as s,Oa as D,P as c,Qa as y,Ra as w,Sa as x,Sb as $,Wa as H,a as N,aa as m,cb as T,d as F,db as E,ha as C,hc as X,ka as b,lc as Y,ma as h,qb as R,sb as z,sc as Z,uc as ee,v as O,va as r,vb as A,vc as te,wa as o,xa as W,xb as K,z as q,zb as Q}from"./chunk-E4UPHNBD.js";import"./chunk-WWX6BADO.js";var xe=(()=>{class i{constructor(){this.http=_(Q),this.api=_(J),this.notificationService=_(V),this.dateService=_(ue),this.host=this.api.host,this.users=C([]),this.loadingUsers=C(!1),this.deliverForm=C(this.resetDeliverForm()),this.deliverInvoice=new F([]),this.invoiceTotal=new F(0),this.checkoutLoading=C(!1),this.getUsers()}getUsers(){this.loadingUsers.set(!0),this.api.get("/deliver/users").pipe(O(()=>{this.loadingUsers.set(!1)})).subscribe({next:e=>{this.users.set(e)}})}calculateTotal(){let e=this.deliverInvoice.value;this.invoiceTotal.next(e.reduce((n,t)=>n+t.quantity*t.unit_price,0))}resetDeliverForm(){return{database_id:null,order_datetime:this.dateService.getCurrentDate(),total_price:0,notes:null}}checkout(e,n){this.checkoutLoading.set(!0),this.http.post(`${this.host}/deliver/invoice`,{order:e,items:n}).subscribe({next:t=>{this.notificationService.showSuccess(t.message,"home"),this.deliverInvoice.next([]),this.deliverForm.set(this.resetDeliverForm()),this.checkoutLoading.set(!1)},error:t=>{this.notificationService.handleError(t.error,"home"),this.checkoutLoading.set(!1)}})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=L({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Me=i=>({"ng-invalid ng-dirty":i}),De=i=>({invalid:i});function Te(i,u){i&1&&(r(0,"small",25),a(1,"User is required."),o())}function Ee(i,u){i&1&&(r(0,"tr")(1,"th",26),a(2,"#"),o(),r(3,"th",27),a(4,"Description"),o(),r(5,"th",28),a(6,"Unit"),o(),r(7,"th",29),a(8,"Qty"),o(),r(9,"th",28),a(10,"Total"),o(),r(11,"th",26),a(12,"Del?"),o()())}function Ve(i,u){if(i&1){let e=f();r(0,"p-inputNumber",35),x("ngModelChange",function(t){s(e);let l=p().$implicit;return w(l.quantity,t)||(l.quantity=t),c(t)}),v("onFocus",function(t){s(e);let l=p(2);return c(l.select(t.target))})("ngModelChange",function(){s(e);let t=p().$implicit,l=p();return c(l.setQty(t))}),o()}if(i&2){let e=p().$implicit;y("ngModel",e.quantity)}}function ke(i,u){if(i&1&&a(0),i&2){let e=p().$implicit;D(" ",e.quantity," ")}}function Fe(i,u){if(i&1){let e=f();r(0,"tr")(1,"td"),a(2),o(),r(3,"td"),a(4),o(),r(5,"td"),a(6),T(7,"currency"),o(),r(8,"td",30)(9,"p-cellEditor"),b(10,Ve,1,1,"ng-template",31)(11,ke,1,1,"ng-template",32),o()(),r(12,"td"),a(13),T(14,"currency"),o(),r(15,"td",33),v("click",function(){let t=s(e).rowIndex,l=p();return c(l.removeRow(t))}),W(16,"i",34),o()()}if(i&2){let e=u.$implicit,n=u.rowIndex;m(2),M(n+1),m(2),M(e.product_name),m(2),M(E(7,6,e.unit_price)),m(2),h("pEditableColumn",e.quantity)("ngClass",H(10,De,!e.quantity)),m(5),D(" ",E(14,8,e.unit_price*e.quantity)," ")}}function He(i,u){}function Pe(i,u){i&1&&(r(0,"tr",36)(1,"td",37),a(2,"No data yet!"),o()())}function Be(i,u){if(i&1){let e=f();r(0,"p-autoComplete",38,1),x("ngModelChange",function(t){s(e);let l=p();return w(l.search_product,t)||(l.search_product=t),c(t)}),v("completeMethod",function(t){s(e);let l=p();return c(l.searchItem(t))})("onKeyUp",function(t){s(e);let l=p();return c(l.submitInvoiceInput(t))}),o(),r(2,"button",39),v("click",function(){s(e);let t=p();return c(t.openProductsDialog())}),o()}if(i&2){let e=p();y("ngModel",e.search_product),h("suggestions",e.matching_products)("delay",150)("autofocus",!0)}}function Ne(i,u){if(i&1){let e=f();r(0,"p-button",40),v("onClick",function(){s(e);let t=p();return c(t.clearInvoice())}),o(),r(1,"p-button",41),v("onClick",function(){s(e);let t=p();return c(t.checkout())}),o()}if(i&2){let e=p();h("disabled",e.deliverInvoice.length===0||e.checkoutLoading()),m(),h("disabled",e.deliverInvoice.length===0||!e.deliverForm().database_id)("loading",e.checkoutLoading())}}var Se=(()=>{class i{constructor(){this.deliverService=_(xe),this.stockService=_(fe),this.notificationService=_(V),this.confirmationService=_($),this.vh=75,this.dialogVisible=!1,this.products=this.stockService.products,this.users=this.deliverService.users,this.userInvalid=!1,this.checkoutLoading=this.deliverService.checkoutLoading,this.deliverForm=this.deliverService.deliverForm,this.search_product=null,this.matching_products=[],this.subscriptions=new N}ngOnInit(){this.subscriptions.add(this.deliverService.deliverInvoice.pipe(q(e=>{this.deliverService.calculateTotal()})).subscribe(e=>{this.deliverInvoice=e})),this.subscriptions.add(this.deliverService.invoiceTotal.subscribe(e=>{this.invoiceTotal=e}))}ngOnDestroy(){this.subscriptions.unsubscribe()}searchItem(e){let n=this.products(),t=[],l=e.query;for(let g=0;g<n.length;g++){let d=n[g];d.product_name.toLowerCase().indexOf(l.toLowerCase())>-1&&t.push(d)}this.matching_products=t}submitInvoiceInput(e){e.key==="Enter"&&(typeof this.search_product=="object"&&this.search_product!==null?this.addProduct(this.search_product):this.search_product&&this.notificationService.showError("Product not found","home"),this.search_product=null)}addProduct(e){let n=this.deliverInvoice.findIndex(t=>t.product_id===e.product_id);n!==-1?(this.deliverInvoice[n].quantity+=1,this.deliverService.deliverInvoice.next(this.deliverInvoice)):this.deliverService.deliverInvoice.next([...this.deliverInvoice,{product_id:e.product_id,product_name:e.product_name,quantity:1,unit_price:e.unit_cost_usd}])}openProductsDialog(){this.dialogVisible=!0}closeProductsDialog(){this.dialogVisible=!1}assignSelectedProducts(e){this.dialogVisible=!1,e.forEach(n=>{this.addProduct(n)})}validate(){this.userInvalid=!1}select(e){e.select()}setPrice(e){e.unit_price,this.deliverService.calculateTotal()}setQty(e){this.deliverService.calculateTotal()}removeRow(e){let n=this.deliverInvoice;this.deliverService.deliverInvoice.next([...n.slice(0,e),...n.slice(e+1)])}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.deliverService.deliverInvoice.next([]),this.deliverService.deliverForm.set(this.deliverService.resetDeliverForm())}})}checkout(){console.log(this.deliverService.deliverForm());let e=0;this.deliverInvoice.forEach(n=>{(n.unit_price==0||!n.unit_price)&&(this.notificationService.showError(`${n.product_name} cannot be 0.00$`,"home"),e++),(n.quantity==0||!n.quantity)&&(this.notificationService.showError(`${n.product_name} Quantity cannot be 0`,"home"),e++)}),e===0&&this.confirmationService.confirm({key:"home",message:'Are you sure that you want to continue"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.deliverForm().total_price=this.invoiceTotal,this.deliverService.checkout(this.deliverForm(),this.deliverInvoice)}})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=j({type:i,selectors:[["app-user-deliver"]],decls:36,vars:21,consts:[["invoiceTable",""],["barcodeInput",""],[1,"grid","m-1"],[1,"col-12","md:col-6"],["styleClass","p-0"],[1,"grid"],[1,"field"],[1,"flex","flex-column","gap-2"],["for","order_datetime"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small",3,"ngModelChange","ngModel","readonlyInput","iconDisplay","showIcon"],["for","user"],["styleClass","p-inputtext-sm w-full","id","user","appendTo","body","optionLabel","database_name","optionValue","database_id","placeholder","Select User","filterBy","database_name",1,"ng-invalid","ng-dirty",3,"ngModelChange","onChange","ngModel","options","filter","showClear","autoOptionFocus","ngClass"],["class","p-error",4,"ngIf"],[1,"text-center","mt-0","mb-0","lg:mt-4","lg:mb-4"],[1,"text-green-500"],[1,"col-12"],["dataKey","product_id_fk","styleClass","p-datatable-sm p-datatable-gridlines mt-3",3,"value","scrollable","scrollHeight","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],["pTemplate","emptymessage"],["styleClass","mt-2 p-2"],["pTemplate","left"],["pTemplate","right"],[3,"onHide","onSubmit","visible"],[1,"p-error"],["width","5%"],["width","40%"],["width","20%"],["width","10%"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["min","1","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],[1,"surface-300"],["colspan","6"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],["label","Clear","icon","pi pi-times","size","small","severity","danger","styleClass","mr-2",3,"onClick","disabled"],["label","Checkout","icon","pi pi-cart-plus","size","small","severity","success",3,"onClick","disabled","loading"]],template:function(n,t){if(n&1){let l=f();r(0,"div",2)(1,"div",3)(2,"p-card",4)(3,"div",5)(4,"div",3)(5,"div",6)(6,"div",7)(7,"label",8),a(8,"Invoice Date"),o(),r(9,"p-calendar",9),x("ngModelChange",function(d){return s(l),w(t.deliverForm().order_datetime,d)||(t.deliverForm().order_datetime=d),c(d)}),o()()()(),r(10,"div",3)(11,"div",6)(12,"div",7)(13,"label",10),a(14,"User"),o(),r(15,"p-dropdown",11),x("ngModelChange",function(d){return s(l),w(t.deliverForm().database_id,d)||(t.deliverForm().database_id=d),c(d)}),v("onChange",function(){return s(l),c(t.validate())}),o(),b(16,Te,2,0,"small",12),o()()()()()(),r(17,"div",3)(18,"p-card")(19,"h1",13)(20,"span",14),a(21,"Total: "),o(),a(22),T(23,"currency"),o()()(),r(24,"div",15)(25,"p-card")(26,"p-table",16,0),b(28,Ee,13,0,"ng-template",17)(29,Fe,17,12,"ng-template",18)(30,He,0,0,"ng-template",19)(31,Pe,3,0,"ng-template",20),o(),r(32,"p-toolbar",21),b(33,Be,3,4,"ng-template",22)(34,Ne,2,3,"ng-template",23),o()()()(),r(35,"deliver-dialog",24),v("onHide",function(){return s(l),c(t.closeProductsDialog())})("onSubmit",function(d){return s(l),c(t.assignSelectedProducts(d))}),o()}n&2&&(m(9),y("ngModel",t.deliverForm().order_datetime),h("readonlyInput",!0)("iconDisplay","input")("showIcon",!0),m(6),y("ngModel",t.deliverForm().database_id),h("options",t.users())("filter",!0)("showClear",!0)("autoOptionFocus",!1)("ngClass",H(19,Me,t.userInvalid)),m(),h("ngIf",t.userInvalid),m(6),D("",E(23,17,t.invoiceTotal)," "),m(4),U("scrollHeight",t.vh),h("value",t.deliverInvoice)("scrollable",!0)("loading",t.checkoutLoading()),m(9),h("visible",t.dialogVisible))},dependencies:[R,z,X,Y,k,ee,G,ie,ne,_e,he,ve,me,le,Ce,ye,se,A],styles:[".editable[_ngcontent-%COMP%]{width:100%;height:28px}[_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-width:0 0 1px;border-color:var(--red-500)!important}"]})}}return i})();var Oe=[{path:"",component:Se}],Ie=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=I({type:i})}static{this.\u0275inj=S({imports:[P.forChild(Oe),P]})}}return i})();var kt=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=I({type:i})}static{this.\u0275inj=S({imports:[K,Z,Ie,k,te,oe,ge,de,ae,pe,be,we,re,ce]})}}return i})();export{kt as DeliverModule};
