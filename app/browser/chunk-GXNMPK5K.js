import{a as h,b as g}from"./chunk-OWTGQR6U.js";import{c as m}from"./chunk-UQQFQ63C.js";import{C as a,G as i,Hb as n,ha as o,z as r}from"./chunk-E4UPHNBD.js";var f=(()=>{class s{constructor(){this.tokenStorage=i(h),this.router=i(n),this.api=i(m),this.userService=i(g),this.token=null,this.isLoggedIn=o(this.tokenStorage.getToken()!==null),this.isAdmin=o(this.tokenStorage.getType()==="admin"),this.userPermissions=o(this.tokenStorage.getPermissions())}setAuthData(t){this.token=t}getToken(){return this.token}login(t){return this.api.post("auth/login",{username:t.username,password:t.password}).pipe(r(e=>{this.tokenStorage.setStorage(t.remember_me),this.tokenStorage.saveUser(e.username),this.tokenStorage.saveType(e.user_type),this.tokenStorage.saveToken(e.token),this.tokenStorage.saveName(e.first_name),this.tokenStorage.savePermissions(e.permissions),this.tokenStorage.saveDatabaseId(e.database_id),this.userService.loggedInUser.set(e.username),this.userService.loggedInName.set(e.first_name),this.userService.databaseId.set(e.database_id),this.userService.userType.set(e.user_type),this.isLoggedIn.set(!0),this.isAdmin.set(e.user_type==="admin"),this.userPermissions.set(e.permissions),this.router.navigate(["/home"])}))}logout(){window.sessionStorage.clear(),this.tokenStorage.logout(),this.isLoggedIn.set(!1),this.isAdmin.set(!1),this.userPermissions.set(null),this.router.navigate(["/login"]),window.location.reload()}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275prov=a({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{f as a};
