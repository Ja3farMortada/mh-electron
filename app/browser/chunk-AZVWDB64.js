import{b as Vt,c as Mt}from"./chunk-POXK75SX.js";import{a as Qe,b as Ht}from"./chunk-TPLBFVKT.js";import{a as Le}from"./chunk-O74WZDVO.js";import{a as ie}from"./chunk-NBCVTIKU.js";import{a as qe}from"./chunk-6AMBXUQL.js";import{a as Ye}from"./chunk-UP3LVANE.js";import{a as he}from"./chunk-6HTKW57C.js";import"./chunk-HT3JZ6CO.js";import{a as Ue}from"./chunk-AK6G6VWP.js";import"./chunk-LHXBPRE2.js";import{a as _e}from"./chunk-GXNMPK5K.js";import"./chunk-CK6XGA6X.js";import{a as Ae}from"./chunk-N5J4AUQI.js";import{a as Re}from"./chunk-Z3UO65U3.js";import"./chunk-OWTGQR6U.js";import"./chunk-MB5UDTNQ.js";import{a as Et,b as Tt}from"./chunk-IZUVX76I.js";import{a as ne}from"./chunk-TSZIFX5L.js";import{a as oe,b as Ke}from"./chunk-DVHYHQJ7.js";import{a as Dt,b as Pt}from"./chunk-GOLNOKOZ.js";import"./chunk-425U57QI.js";import"./chunk-7PIM7VCW.js";import{a as je}from"./chunk-GSMGX6RX.js";import{a as It,b as Ge}from"./chunk-7LKCTRLS.js";import"./chunk-MEVQH5BX.js";import{A as xt,B as wt,F as ze,i as te,j as Oe,l as bt,m as St,p as O,q as We,v as W}from"./chunk-DNVA5LVB.js";import{b as ue,c as Y}from"./chunk-UQQFQ63C.js";import{$b as B,$c as Ct,Ba as x,C as Ee,Ca as d,D as Te,Da as p,Ec as le,F as xe,Fc as R,G as S,Ga as ut,Gc as Ne,H as P,Hc as ee,I as De,Ic as $e,Ma as s,N as ct,Na as h,Nb as rt,O as u,Oa as b,P as _,Qa as w,Ra as I,Sa as E,Sb as ft,T as ot,Ua as _t,Va as D,Wa as we,Xa as de,Ya as ht,_c as ce,a as re,aa as a,ba as V,cb as v,d as nt,db as C,dc as K,ha as z,hc as N,ic as Q,jc as se,ka as f,kc as M,lc as Me,ma as c,mc as J,ob as gt,oc as X,pa as ae,pc as Z,qb as Pe,qc as yt,rc as Fe,sa as mt,sb as U,sc as ke,ta as pt,tc as vt,ua as dt,uc as $,v as lt,va as i,vb as k,vc as Be,wa as o,xa as y,xb as He,zb as Ve}from"./chunk-E4UPHNBD.js";import{g as Ie}from"./chunk-WWX6BADO.js";var Rt=Ie(qe());var kt=(()=>{class n{constructor(e,r,t,l){this.apiService=e,this.http=r,this.notificationService=t,this.customersService=l,this.host=this.apiService.host,this.currentInvoice=z({}),this.signal_submited=z(!1),this.signal_submit_loading=z(!1),this.action_status$=new nt(""),this.selectedCustomerLatestItems=new nt([])}chcekout(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/sell-orders`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.customersService.getAccountTotalBalance(e.customer_id)}})}returnChcekout(e,r){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.apiService.host}/return`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.customersService.getAccountTotalBalance(e.customer_id)}})}deleteInvoice(e,r){let t=e.order_id;console.log(t),this.signal_submited.set(!0),this.http.delete(`${this.host}/sell-orders/${t}`).subscribe({next:l=>{this.notificationService.showSuccess(l.message,"home")},error:l=>{this.notificationService.handleError(l.error,"home"),this.signal_submited.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.customersService.getAccountTotalBalance(e.customer_id)}})}returnDeleteInvoice(e,r){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host}/return/${t}`).subscribe({next:l=>{this.notificationService.showSuccess(l.message,"home")},error:l=>{this.notificationService.handleError(l.error,"home"),this.signal_submited.set(!1)},complete:()=>{r.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.customersService.getAccountTotalBalance(e.customer_id)}})}getCustomerLatestPurchase(e){this.http.get(`${this.apiService.host}/customers/${e}/purchases/latest`).subscribe({next:r=>{this.selectedCustomerLatestItems.next(r)}})}static{this.\u0275fac=function(r){return new(r||n)(xe(Y),xe(Ve),xe(ue),xe(ie))}}static{this.\u0275prov=Ee({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var ti=()=>({width:"95vw",height:"75vh"}),at=()=>({standalone:!0}),ii=n=>({"ng-invalid ng-dirty":n}),Bt=n=>({invalid:n}),ni=n=>({"text-red-500":n}),oi=(n,m)=>({"text-red-500":n,"text-orange-500":m});function ri(n,m){n&1&&(i(0,"small",31),s(1,"Customer is required."),o())}function ai(n,m){if(n&1){let e=x();i(0,"div",28)(1,"p-radioButton",32),E("ngModelChange",function(t){u(e);let l=p(3);return I(l.selected_price_type,t)||(l.selected_price_type=t),_(t)}),o(),i(2,"label",33),s(3),o()()}if(n&2){let e=m.$implicit,r=p(3);a(),c("value",e),w("ngModel",r.selected_price_type),c("ngModelOptions",D(6,at))("inputId",e),a(),c("for",e),a(),b(" ",r.getPriceTypeLabel(e)," ")}}function si(n,m){if(n&1){let e=x();i(0,"div",6)(1,"div",18)(2,"div",19),y(3,"div",20),i(4,"label"),s(5,"Invoice Date"),o(),i(6,"p-calendar",21),E("ngModelChange",function(t){u(e);let l=p(2);return I(l.invoice_date,t)||(l.invoice_date=t),_(t)}),o()()(),i(7,"div",18)(8,"div",20)(9,"label",22),s(10,"Customer"),i(11,"span",23),s(12," *"),o()(),i(13,"p-dropdown",24),E("ngModelChange",function(t){u(e);let l=p(2);return I(l.customer_id,t)||(l.customer_id=t),_(t)}),d("onChange",function(t){u(e);let l=p(2);return _(l.customerChange(t.value))}),o(),f(14,ri,2,0,"small",25),o()(),i(15,"div",26)(16,"div",27)(17,"div",28)(18,"p-radioButton",29),E("ngModelChange",function(t){u(e);let l=p(2);return I(l.selected_price_type,t)||(l.selected_price_type=t),_(t)}),o(),i(19,"label",30),s(20),o()(),pt(21,ai,4,7,"div",28,mt),o()()()}if(n&2){let e=p(2);a(6),w("ngModel",e.invoice_date),c("ngModelOptions",D(16,at))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0)("showSeconds",!0),a(7),w("ngModel",e.customer_id),c("options",e.customers)("filter",!0)("showClear",!0)("ngClass",we(17,ii,!e.customer_id)),a(),c("ngIf",!e.customer_id),a(4),w("ngModel",e.selected_price_type),c("ngModelOptions",D(19,at)),a(2),b(" ",e.getPriceTypeLabel("latest")," "),a(),dt(e.priceTypes)}}function li(n,m){if(n&1&&(i(0,"div",6)(1,"div",34)(2,"div",35),s(3," Total: "),o(),i(4,"div",36),s(5),v(6,"currency"),o()()()),n&2){let e=p(2);a(5),b(" ",C(6,1,e.invoiceTotal.total_dollar)," ")}}function ci(n,m){n&1&&(i(0,"tr")(1,"th",37),s(2,"#"),o(),i(3,"th",38),s(4,"Description"),o(),i(5,"th",37),s(6,"Cost"),o(),i(7,"th",37),s(8,"Qty"),o(),i(9,"th",39),s(10,"Unit"),o(),i(11,"th",39),s(12,"Total"),o(),i(13,"th",37),s(14,"Del?"),o()())}function mi(n,m){if(n&1){let e=x();i(0,"p-inputNumber",46),E("ngModelChange",function(t){u(e);let l=p().$implicit;return I(l.quantity,t)||(l.quantity=t),_(t)}),d("onFocus",function(t){u(e);let l=p(3);return _(l.select(t.target))})("ngModelChange",function(){u(e);let t=p().$implicit,l=p(2);return _(l.setQty(t))}),o()}if(n&2){let e=p().$implicit;w("ngModel",e.quantity)}}function pi(n,m){if(n&1&&(i(0,"span",47),s(1),o()),n&2){let e=p().$implicit;c("ngClass",we(2,ni,!e.quantity)),a(),h(e.quantity)}}function di(n,m){if(n&1){let e=x();i(0,"p-inputNumber",48),E("ngModelChange",function(t){u(e);let l=p().$implicit;return I(l.unit_price,t)||(l.unit_price=t),_(t)}),d("ngModelChange",function(){u(e);let t=p().$implicit,l=p(2);return _(l.setPrice(t))})("onFocus",function(t){u(e);let l=p(3);return _(l.select(t.target))}),o()}if(n&2){let e=p().$implicit;w("ngModel",e.unit_price),c("maxFractionDigits",2)("min",0)}}function ui(n,m){n&1&&y(0,"i",50)}function _i(n,m){if(n&1&&(i(0,"span",47),s(1),v(2,"currency"),i(3,"span"),f(4,ui,1,0,"i",49),o()()),n&2){let e=p().$implicit,r=p(2);c("ngClass",de(5,oi,!e.unit_price,r.getPriceWarining(e))),a(),h(C(2,3,e.unit_price)),a(3),c("ngIf",r.getPriceWarining(e))}}function hi(n,m){if(n&1){let e=x();i(0,"tr")(1,"td"),s(2),o(),i(3,"td"),s(4),o(),i(5,"td"),s(6),v(7,"currency"),o(),i(8,"td",40)(9,"p-cellEditor"),f(10,mi,1,1,"ng-template",41)(11,pi,2,4,"ng-template",42),o()(),i(12,"td",43)(13,"p-cellEditor"),f(14,di,1,3,"ng-template",41)(15,_i,5,8,"ng-template",42),o()(),i(16,"td"),s(17),v(18,"currency"),o(),i(19,"td",44),d("click",function(){let t=u(e).rowIndex,l=p(2);return _(l.removeRow(t))}),y(20,"i",45),o()()}if(n&2){let e=m.$implicit,r=m.rowIndex;a(2),h(r+1),a(2),h(e.product_name),a(2),h(C(7,8,e.unit_cost)),a(2),c("pEditableColumn",e.quantity)("ngClass",we(12,Bt,!e.quantity)),a(4),c("pEditableColumn",e.unit_price)("ngClass",we(14,Bt,!e.unit_price)),a(5),b(" ",C(18,10,e.unit_price*e.quantity)," ")}}function gi(n,m){if(n&1&&(i(0,"h4",52),s(1),o()),n&2){let e=p(3);a(),b(" Total units: ",e.invoiceTotal.total_qty," ")}}function fi(n,m){if(n&1&&f(0,gi,2,1,"h4",51),n&2){let e=p(2);c("ngIf",e.invoiceTotal.total_qty)}}function yi(n,m){n&1&&(i(0,"tr",53)(1,"td",54),s(2,"No data yet!"),o()())}function vi(n,m){if(n&1){let e=x();i(0,"div",6)(1,"div",7)(2,"p-card"),f(3,si,23,20,"ng-template",3),o()(),i(4,"div",8)(5,"p-card"),f(6,li,7,3,"ng-template",3),o()()(),i(7,"p-card",9)(8,"div",6)(9,"div",10)(10,"p-table",11,0),f(12,ci,15,0,"ng-template",12)(13,hi,21,16,"ng-template",3)(14,fi,1,1,"ng-template",13)(15,yi,3,0,"ng-template",14),o()(),i(16,"div",15)(17,"p-autoComplete",16,1),E("ngModelChange",function(t){u(e);let l=p();return I(l.search_product,t)||(l.search_product=t),_(t)}),d("completeMethod",function(t){u(e);let l=p();return _(l.searchItem(t))})("onKeyUp",function(t){u(e);let l=p();return _(l.submitInvoiceInput(t))}),o(),i(19,"button",17),d("click",function(){u(e);let t=p();return _(t.openProductsDialog())}),o()()()()}if(n&2){let e=p();a(10),ut("scrollHeight",e.vh),c("value",e.order_items)("scrollable",!0),a(7),w("ngModel",e.search_product),c("suggestions",e.matching_products)("delay",150)("autofocus",!0)}}function Ci(n,m){if(n&1){let e=x();i(0,"p-button",55),d("onClick",function(){u(e);let t=p();return _(t.deleteInvoice())}),o(),i(1,"p-button",56),d("onClick",function(){u(e);let t=p();return _(t.closeEditDialog())}),o(),i(2,"p-button",57),d("onClick",function(){u(e);let t=p();return _(t.submitEditInvoice())}),o()}if(n&2){let e=p();c("disabled",e.submitted()),a(),c("disabled",e.submitted()),a(),c("loading",e.submitted())("disabled",e.order_items.length==0)}}var Xe=(()=>{class n{constructor(e,r,t,l){this.editInvoiceService=e,this.authService=r,this.confirmationService=t,this.notificationsService=l,this.visible=!1,this.customers=[],this.return_invoice_edit=!1,this.onSubmit=new ot,this.onHide=new ot,this.stockService=this.authService.isAdmin()?S(Ae):S(Re),this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new Qe,this.order_items=[],this.customer_id=0,this.invoice_number="123",this.selected_price_type="latest",this.selectedCustomerLatestItems=[],this.productsDialogVisible=!1,this.subscriptions=new re,this.products=this.stockService.getProducts(),this.matching_products=[],this.priceTypes=Object.keys(Ht),this.editDialogVisible=!1,this.vh="50vh"}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(e=>{(e==="UPDATE"||e==="DELETE")&&(this.onSubmit.emit({action:e}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.editInvoiceService.selectedCustomerLatestItems.subscribe(e=>{this.selectedCustomerLatestItems=e}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=this.invoice.order_datetime,this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.order_items=structuredClone(this.invoice.items),this.customer_id=this.invoice.customer_id,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_amount,this.calculateTotal(),this.customerChange(this.invoice.customer_id))}setPrice(e){e.unit_price?this.validateItems():this.form_error=!0,this.calculateTotal()}setQty(e){e.quantity?this.validateItems():this.form_error=!0,this.calculateTotal()}validateItems(){return this.order_items.find(r=>!r.unit_price||!r.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(e){let r=this.order_items.find(t=>t.product_id===e.product_id);if(r)r.quantity+=1,this.calculateTotal();else{let t=0;if(this.selected_price_type==="latest"){let l=this.selectedCustomerLatestItems.find(g=>g.product_id===e.product_id);l&&(console.log("expected",l),t=l.unit_price)}else t=e[this.selected_price_type]||0;this.order_items.push({product_id:e.product_id,product_name:e.product_name,unit_price:t,price_type:this.selected_price_type,stock:e.quantity,quantity:1,unit_cost:e.unit_cost_usd,avg_cost:e.avg_cost_usd}),this.calculateTotal()}}submitInvoiceInput(e){e.key==="Enter"&&(typeof this.search_product=="object"&&this.search_product!==null?this.addProduct(this.search_product):this.search_product&&this.notificationsService.showError("Product not found","home"),this.search_product=null)}calculateTotal(){let e=new Qe,r=this.order_items;return r.length>0&&(r.forEach(t=>{e.total_qty+=t.quantity,e.cost_dollar+=t.unit_cost*t.quantity,e.subtotal_dollar+=t.unit_price*t.quantity}),e.total_dollar=e.subtotal_dollar-e.discount_dollar),this.invoiceTotal=e,e}submitEditInvoice(){let e=this.validateItems();this.customer_id&&!e?this.return_invoice_edit?this.editInvoiceService.returnChcekout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):this.editInvoiceService.chcekout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_amount:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number},this.stockService):e&&this.notificationsService.showError("Please enter price for all items","home")}searchItem(e){let r=this.products(),t=[],l=e.query;for(let g=0;g<r.length;g++){let q=r[g];q.product_name.toLowerCase().indexOf(l.toLowerCase())>-1&&t.push(q)}this.matching_products=t}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}customerChange(e){this.customer_id?this.editInvoiceService.getCustomerLatestPurchase(this.customer_id):this.selectedCustomerLatestItems=[]}removeRow(e){this.order_items.splice(e,1),this.calculateTotal()}openProductsDialog(){this.productsDialogVisible=!0}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.order_items=[],this.submitted.set(!1),this.invoiceTotal=new Qe}})}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.return_invoice_edit?this.editInvoiceService.returnDeleteInvoice(this.invoice,this.stockService):this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(e){this.productsDialogVisible=!1,e.forEach(r=>{this.addProduct(r)})}getPriceTypeLabel(e){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[e]}select(e){e.select()}getPriceWarining(e){if(!e.unit_price)return!1;let r=e.unit_cost||0,t=e.unit_price;return typeof r=="string"&&(r=parseFloat(r)),typeof t=="string"&&(t=parseFloat(t)),t<r}static{this.\u0275fac=function(r){return new(r||n)(V(kt),V(_e),V(ft),V(ue))}}static{this.\u0275cmp=P({type:n,selectors:[["edit-invoice"]],inputs:{visible:"visible",invoice:"invoice",customers:"customers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[ct],decls:4,vars:10,consts:[["invoiceTable",""],["barcodeInput",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","products","price"],[1,"grid"],[1,"col-12","md:col-9"],[1,"col-12","md:col-3"],["styleClass","mt-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime","showSeconds"],["for","customer"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear","ngClass"],["class","p-error",4,"ngIf"],[1,"col-12","md:col-4","pb-0"],[1,"flex","flex-wrap","gap-3","justify-content-between","align-content-center","h-full"],[1,"flex","align-items-center"],["value","latest","inputId","latest",3,"ngModelChange","ngModel","ngModelOptions"],["for","latest",1,"ml-2"],[1,"p-error"],[3,"ngModelChange","value","ngModel","ngModelOptions","inputId"],[1,"ml-2",3,"for"],[1,"col-12","text-center"],[1,"text-green-500","text-900","font-medium","text-xl"],[1,"text-900","font-medium","text-xl"],["width","5%"],["width","40%"],["width","15%"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["min","0","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],[3,"ngClass"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["label","Delete","icon","pi pi-trash","severity","danger","size","small","styleClass","w-full mt-4 md:w-auto md:mt-0",3,"onClick","disabled"],["label","Cancel Edit","icon","pi pi-times","size","small","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","disabled"],["label","Submit Edit","icon","pi pi-check","size","small","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","loading","disabled"]],template:function(r,t){r&1&&(i(0,"p-dialog",2),E("visibleChange",function(g){return I(t.visible,g)||(t.visible=g),g}),d("onHide",function(){return t.closeEditDialog()}),f(1,vi,20,7,"ng-template",3)(2,Ci,3,4,"ng-template",4),o(),i(3,"products-dialog",5),d("onHide",function(){return t.productsDialogVisible=!1})("onSubmit",function(g){return t.assignSelectedProducts(g)}),o()),r&2&&(ae(D(9,ti)),w("visible",t.visible),c("modal",!0)("closable",!0)("maximizable",!0),a(3),c("visible",t.productsDialogVisible)("products",t.products)("price",t.selected_price_type))},dependencies:[Pe,U,N,Me,Ue,W,B,xt,wt,le,R,$,ce,te,O,bt,Et,Dt,k],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:100%;height:28px}[_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}"]})}}return n})();var Si=()=>[10,25,50],xi=()=>({width:"95vw"});function wi(n,m){n&1&&(i(0,"tr")(1,"th"),s(2,"Invoice #"),o(),i(3,"th"),s(4,"Customer"),o(),i(5,"th"),s(6,"Datetime"),o(),i(7,"th"),s(8,"total"),o(),i(9,"th",19),s(10,"Options"),o()())}function Ii(n,m){if(n&1){let e=x();i(0,"p-button",24),d("onClick",function(){u(e);let t=p().$implicit,l=p();return _(l.openEditDialog(t))}),o()}}function Ei(n,m){if(n&1){let e=x();i(0,"td")(1,"p-button",25),d("onClick",function(){u(e);let t=p().$implicit,l=p();return _(l.thermalPrint(t))}),o()()}}function Ti(n,m){if(n&1){let e=x();i(0,"tr")(1,"td"),s(2),o(),i(3,"td"),s(4),o(),i(5,"td"),s(6),o(),i(7,"td"),s(8),v(9,"currency"),o(),i(10,"td")(11,"button",20),d("click",function(){let t=u(e).$implicit,l=p();return _(l.showInvoiceDialog(t))}),o()(),i(12,"td"),f(13,Ii,1,0,"p-button",21),o(),f(14,Ei,2,0,"td",22),i(15,"td")(16,"p-button",23),d("onClick",function(){let t=u(e).$implicit,l=p();return _(l.sendWhatsapp(t))}),o()()()}if(n&2){let e,r=m.$implicit,t=p();a(2),h(r.invoice_number),a(2),h(r.customer_name),a(2),h(r.order_datetime),a(2),h(C(9,6,r.total_amount)),a(5),c("ngIf",((e=t.userPermissions())==null?null:e.edit_invoice)||!1),a(),c("ngIf",t.isWeb)}}function Di(n,m){n&1&&(i(0,"tr")(1,"td",26),s(2,"No Records Found!"),o()())}function Pi(n,m){n&1&&(i(0,"tr")(1,"th",29),s(2,"Description"),o(),i(3,"th",30),s(4,"Unit Price"),o(),i(5,"th",31),s(6,"Qty"),o(),i(7,"th",30),s(8,"Total Price"),o()())}function Hi(n,m){if(n&1&&(i(0,"tr")(1,"td"),s(2),o(),i(3,"td"),s(4),v(5,"currency"),o(),i(6,"td"),s(7),o(),i(8,"td"),s(9),v(10,"currency"),o()()),n&2){let e=m.$implicit;a(2),h(e.product_name),a(2),b(" ",C(5,4,e.unit_price)," "),a(3),h(e.quantity),a(2),b(" ",C(10,6,e.total_price)," ")}}function Vi(n,m){if(n&1&&(i(0,"tr"),y(1,"td")(2,"td"),i(3,"td"),s(4),o(),i(5,"td"),s(6),v(7,"currency"),o()()),n&2){let e=p(3);a(4),h(e.selectedInvoiceTotals.totalQty),a(2),b(" Total: ",C(7,2,e.selectedInvoiceTotals.totalPrice)," ")}}function Mi(n,m){if(n&1&&(i(0,"p-table",28),f(1,Pi,9,0,"ng-template",12)(2,Hi,11,8,"ng-template",13)(3,Vi,8,4,"ng-template",17),o()),n&2){let e=p(2);c("value",e.invoiceItems)}}function Fi(n,m){if(n&1&&f(0,Mi,4,1,"p-table",27),n&2){let e=p();c("ngIf",e.invoiceItems.length!=0)}}function ki(n,m){if(n&1){let e=x();i(0,"button",32),d("click",function(){u(e);let t=p();return _(t.hideInvoiceDialog())}),o()}}var Ot=(()=>{class n{constructor(e,r,t){this.customerService=e,this.historyService=r,this.decimalService=t,this.api=S(Y),this.authService=S(_e),this.userPermissions=this.authService.userPermissions,this.isWeb=!window.electron,this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.subscriptions=new re,this.salesHistory=this.historyService.salesHistory,this.loading=this.historyService.signal_loading,this.host=this.historyService.host,this.searchForm=new se({invoice_number:new M(null),customer_id:new M(null),invoice_date:new M(null)}),this.submitSearch()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,Rt.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchSalesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchSalesHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(r=>{this.selectedInvoiceTotals.totalQty+=r.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,r.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,r.unit_cost)}),this.detailsDialogVisible=!0}printInvoice(e){}printDelivery(e){}openEditDialog(e){console.log(e),this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(e){this.historyService.fetchSalesHistory(this.searchForm.value)}sendWhatsapp(e){let r=e,t=r.customer_name,q=`961${r.customer_phone.replace(/\s+/g,"").replace(/^0/,"")}`,me=r.items.map((T,A)=>`\u2022 ${T.product_name} -> ${T.quantity}\xD7$${T.unit_price} = $${T.total_price}`).join(`
`);this.api.get(`/customers/${e.customer_id}/balance`).subscribe({next:T=>{console.log(T);let A=T.balance,j=`
Invoice #${r.invoice_number}
Date:${r.order_datetime}
Customer:${t}

${me}

Total: $${r.total_amount}

Remaining Balance: $${A}`,F=`https://wa.me/${q}?text=${encodeURIComponent(j.trim())}`;window.open(F,"_blank")}})}thermalPrint(e){let r=e,t=r.customer_name,l=32,g=(T,A)=>{let j=T.split(" "),F=[],H="";for(let G of j)(H+G).length>A?(F.push(H.trim()),H=G+" "):H+=G+" ";return H.trim().length>0&&F.push(H.trim()),F},q=T=>{let A=T.product_name.trim(),j=T.quantity,F=`$${T.total_price}`,H=l-10,G=g(A,H),pe="";return G.forEach((it,Qt)=>{if(Qt===0){let Jt=l-(it.length+`${j}x${F}`.length),Xt=" ".repeat(Math.max(Jt,1));pe+=`${it}${Xt}${j}x${F}
`}else pe+=`${it}
`}),pe+=`
`,pe},me=r.items.map(q).join("");this.api.get(`/customers/${e.customer_id}/balance`).subscribe({next:T=>{let A=T.balance,F=`${(G=>{let pe=Math.floor((l-G.length)/2);return" ".repeat(Math.max(pe,0))+G})("*** Invoice ***")}



${"INVOICE #: "+r.invoice_number}
Customer: ${t}
Date: ${r.order_datetime}
-------------------------------
${me}
-------------------------------
Total:      $${r.total_amount}

Remaining:  $${A}
-------------------------------`,H="rawbt:"+encodeURIComponent(F);window.location.href=H}})}static{this.\u0275fac=function(r){return new(r||n)(V(ie),V(ne),V(he))}}static{this.\u0275cmp=P({type:n,selectors:[["app-sell-history"]],decls:23,vars:29,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers"],["colspan","4","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-info",3,"click"],["size","small","icon","pi pi-file-edit","severity","warning",3,"onClick",4,"ngIf"],[4,"ngIf"],["size","small","icon","pi pi-whatsapp","severity","success",3,"onClick"],["size","small","icon","pi pi-file-edit","severity","warning",3,"onClick"],["size","small","severity","contrast","icon","pi pi-print",3,"onClick"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","50%"],["width","20%"],["width","10%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.submitSearch()}),i(5,"div",4)(6,"div",5),y(7,"input",6),o(),i(8,"div",5),y(9,"p-dropdown",7),o(),i(10,"div",5),y(11,"p-calendar",8),o(),i(12,"div",5),y(13,"p-button",9),i(14,"p-button",10),d("onClick",function(){return t.resetSearch()}),o()()()()(),i(15,"p-table",11),f(16,wi,11,0,"ng-template",12)(17,Ti,17,8,"ng-template",13)(18,Di,3,0,"ng-template",14),o()()()(),i(19,"p-dialog",15),E("visibleChange",function(g){return I(t.detailsDialogVisible,g)||(t.detailsDialogVisible=g),g}),d("onHide",function(){return t.hideInvoiceDialog()}),f(20,Fi,1,1,"ng-template",16)(21,ki,1,0,"ng-template",17),o(),i(22,"edit-invoice",18),d("onHide",function(){return t.closeEditDialog()})("onSubmit",function(g){return t.submitEdit(g)}),o()),r&2&&(a(3),c("toggleable",!0),a(),c("formGroup",t.searchForm),a(5),c("options",t.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(2),c("loading",t.loading()),a(),c("disabled",t.loading()),a(),c("value",t.salesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",D(27,Si))("alwaysShowPaginator",!1)("loading",t.loading()),a(4),ae(D(28,xi)),w("visible",t.detailsDialogVisible),c("modal",!0)("closable",!0)("maximizable",!0),a(3),c("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("customers",t.customers()))},dependencies:[U,J,K,N,Q,X,Z,W,B,le,R,$,ce,ee,te,O,oe,Xe,k]})}}return n})();var Wt=Ie(qe());var Bi=()=>[10,25,50];function Ni(n,m){n&1&&(i(0,"tr")(1,"th"),s(2,"Payment #"),o(),i(3,"th"),s(4,"Customer"),o(),i(5,"th"),s(6,"Datetime"),o(),i(7,"th"),s(8,"total"),o(),i(9,"th",16),s(10,"Options"),o()())}function $i(n,m){if(n&1){let e=x();i(0,"p-button",20),d("onClick",function(){u(e);let t=p().$implicit,l=p();return _(l.thermalPrint(t))}),o()}}function Ri(n,m){if(n&1){let e=x();i(0,"tr")(1,"td"),s(2),o(),i(3,"td"),s(4),o(),i(5,"td"),s(6),o(),i(7,"td"),s(8),v(9,"currency"),o(),i(10,"td")(11,"p-button",17),d("onClick",function(){let t=u(e).$implicit,l=p();return _(l.openEditDialog(t))}),o()(),i(12,"td"),f(13,$i,1,0,"p-button",18),o(),i(14,"td")(15,"p-button",19),d("onClick",function(){let t=u(e).$implicit,l=p();return _(l.sendWhatsapp(t))}),o()()()}if(n&2){let e=m.$implicit,r=p();a(2),h(e.journal_number),a(2),h(e.partner_name),a(2),h(e.payment_date),a(2),h(C(9,5,e.total_value)),a(5),c("ngIf",r.isWeb)}}function Oi(n,m){n&1&&(i(0,"tr")(1,"td",21),s(2,"No Records Found!"),o()())}var jt=(()=>{class n{constructor(){this.api=S(Y),this.customerService=S(ie),this.historyService=S(ne),this.isWeb=!window.electron,this.customers=this.customerService.customers,this.customersLoading=this.customerService.signal_tableLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.paymentsHistory=this.historyService.paymentsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new se({payment_date:new M(null),partner_id:new M(null),payment_number:new M(null)}),this.submitSearch()}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.searchForm.value.payment_date&&(this.searchForm.value.payment_date=(0,Wt.default)(this.searchForm.value.payment_date).format("YYYY-MM-DD")),this.historyService.fetchPaymentHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPaymentHistory(null)}openEditDialog(e){console.log(e),this.selectedPayment=e,this.editDialogVisible=!0}hidePaymentDialog(){this.editDialogVisible=!1}getPaymentDilogResult(e){this.historyService.fetchPaymentHistory(this.searchForm.value)}onUpdatePayment(e){let r=this.paymentsHistory().findIndex(t=>t.journal_id===e.journal_id);this.paymentsHistory.update(t=>[...t.slice(0,r),e,...t.slice(r+1)]),this.editDialogVisible=!1}onDeletePayment(e){this.paymentsHistory.update(r=>{let t=this.paymentsHistory().findIndex(l=>l.journal_id===e.journal_id);return r.splice(t,1),[...r]}),this.editDialogVisible=!1}thermalPrint(e){let r=e.amount||0;console.log(e.customer_id),this.api.get(`/customers/${e.customer_id}/balance`).subscribe({next:t=>{console.log(t);let l=t.balance,g=e.customer_name,q=e.journal_number,me=e.payment_date,T=32,j=`${(H=>{let G=Math.floor((T-H.length)/2);return" ".repeat(Math.max(G,0))+H})("*** PAYMENT RECEIPT ***")}



Receipt #: ${q}
Customer: ${g}
Date: ${me}
-------------------------------
Payment Amount:  $${r}
Remaining: $${l}
-------------------------------`,F="rawbt:"+encodeURIComponent(j.trim());window.location.href=F}})}sendWhatsapp(e){let r=e.amount;this.api.get(`/customers/${e.customer_id}/balance`).subscribe({next:t=>{console.log(t);let l=t.balance,g=e.customer_name,q=e.customer_phone,me=e.journal_number,T=e.payment_date,j=`961${q.replace(/\s+/g,"").replace(/^0/,"")}`,F=`
            Payment #: ${me}
            Customer: ${g}
            Date: ${T}

            Payment Amount: $${r}
            Remaining: $${l}`,H=`https://wa.me/${j}?text=${encodeURIComponent(F.trim())}`;window.open(H,"_blank")}})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=P({type:n,selectors:[["app-payment-history"]],decls:20,vars:23,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","loading","filter","showClear","autoOptionFocus"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["formControlName","payment_number","type","search","placeholder","Payment #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"visibleChange","onUpdate","onDelete","visible","payment","mode"],["colspan","3","width","10%"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick"],["icon","pi pi-print","severity","contrast","size","small",3,"onClick",4,"ngIf"],["icon","pi pi-whatsapp","severity","success","size","small",3,"onClick"],["icon","pi pi-print","severity","contrast","size","small",3,"onClick"],["colspan","11"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.submitSearch()}),i(5,"div",4)(6,"div",5),y(7,"p-dropdown",6),o(),i(8,"div",5),y(9,"p-calendar",7),o(),i(10,"div",5),y(11,"input",8),o(),i(12,"div",5),y(13,"p-button",9),i(14,"p-button",10),d("onClick",function(){return t.resetSearch()}),o()()()()(),i(15,"p-table",11),f(16,Ni,11,0,"ng-template",12)(17,Ri,16,7,"ng-template",13)(18,Oi,3,0,"ng-template",14),o()()()(),i(19,"payment-dialog",15),E("visibleChange",function(g){return I(t.editDialogVisible,g)||(t.editDialogVisible=g),g}),d("onUpdate",function(g){return t.onUpdatePayment(g)})("onDelete",function(g){return t.onDeletePayment(g)}),o()),r&2&&(a(3),c("toggleable",!0),a(),c("formGroup",t.searchForm),a(3),c("options",t.customers())("loading",t.customersLoading())("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(4),c("loading",t.loading()),a(),c("disabled",t.loading()),a(),c("value",t.paymentsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",D(22,Bi))("alwaysShowPaginator",!1)("loading",t.loading()),a(4),w("visible",t.editDialogVisible),c("payment",t.selectedPayment)("mode","edit"))},dependencies:[U,J,K,N,Q,X,Z,W,B,R,$,ee,te,O,oe,Le,k]})}}return n})();var zt=Ie(qe());var Wi=()=>[10,25,50],ji=()=>({width:"95vw"});function zi(n,m){n&1&&(i(0,"tr")(1,"th"),s(2,"Invoice #"),o(),i(3,"th"),s(4,"Customer"),o(),i(5,"th"),s(6,"Datetime"),o(),i(7,"th"),s(8,"total"),o(),i(9,"th",19),s(10,"Options"),o()())}function Li(n,m){if(n&1){let e=x();i(0,"tr")(1,"td"),s(2),o(),i(3,"td"),s(4),o(),i(5,"td"),s(6),o(),i(7,"td"),s(8),v(9,"currency"),o(),i(10,"td")(11,"button",20),d("click",function(){let t=u(e).$implicit,l=p();return _(l.showInvoiceDialog(t))}),o()(),i(12,"td")(13,"button",21),d("click",function(){let t=u(e).$implicit,l=p();return _(l.printInvoice(t))}),o()(),i(14,"td")(15,"button",22),d("click",function(){let t=u(e).$implicit,l=p();return _(l.openEditDialog(t))}),o()()()}if(n&2){let e=m.$implicit;a(2),h(e.invoice_number),a(2),h(e.customer_name),a(2),h(e.order_date),a(2),h(C(9,4,e.total_amount))}}function qi(n,m){n&1&&(i(0,"tr")(1,"td",23),s(2,"No Records Found!"),o()())}function Ai(n,m){n&1&&(i(0,"tr")(1,"th",26),s(2,"Description"),o(),i(3,"th",27),s(4,"Unit Price"),o(),i(5,"th",28),s(6,"Qty"),o(),i(7,"th",27),s(8,"Total Price"),o()())}function Gi(n,m){if(n&1&&(i(0,"tr")(1,"td"),s(2),o(),i(3,"td"),s(4),v(5,"currency"),o(),i(6,"td"),s(7),o(),i(8,"td"),s(9),v(10,"currency"),o()()),n&2){let e=m.$implicit;a(2),h(e.product_name),a(2),b(" ",C(5,4,e.unit_price)," "),a(3),h(e.quantity),a(2),b(" ",C(10,6,e.total_price)," ")}}function Ui(n,m){if(n&1&&(i(0,"tr"),y(1,"td")(2,"td"),i(3,"td"),s(4),o(),i(5,"td"),s(6),v(7,"currency"),o()()),n&2){let e=p(3);a(4),h(e.selectedInvoiceTotals.totalQty),a(2),b(" Total: ",C(7,2,e.selectedInvoiceTotals.totalPrice)," ")}}function Yi(n,m){if(n&1&&(i(0,"p-table",25),f(1,Ai,9,0,"ng-template",12)(2,Gi,11,8,"ng-template",13)(3,Ui,8,4,"ng-template",17),o()),n&2){let e=p(2);c("value",e.invoiceItems)}}function Ki(n,m){if(n&1&&f(0,Yi,4,1,"p-table",24),n&2){let e=p();c("ngIf",e.invoiceItems.length!=0)}}function Qi(n,m){if(n&1){let e=x();i(0,"button",29),d("click",function(){u(e);let t=p();return _(t.hideInvoiceDialog())}),o()}}var Lt=(()=>{class n{constructor(e,r,t){this.customerService=e,this.historyService=r,this.decimalService=t,this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.subscriptions=new re,this.returnHistory=this.historyService.returnHistory,this.loading=this.historyService.signal_loading,this.searchForm=new se({invoice_number:new M(null),customer_id:new M(null),invoice_date:new M(null)}),this.submitSearch()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=(0,zt.default)(this.searchForm.value.invoice_date).format("YYYY-MM-DD")),this.historyService.fetchReturnHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReturnHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(r=>{this.selectedInvoiceTotals.totalQty+=r.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,r.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,r.unit_cost)}),this.detailsDialogVisible=!0}printInvoice(e){}printDelivery(e){}openEditDialog(e){console.log(e),this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(e){this.historyService.fetchReturnHistory(this.searchForm.value)}static{this.\u0275fac=function(r){return new(r||n)(V(ie),V(ne),V(he))}}static{this.\u0275cmp=P({type:n,selectors:[["app-sell-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers","return_invoice_edit"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","pi pi-print",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","50%"],["width","20%"],["width","10%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.submitSearch()}),i(5,"div",4)(6,"div",5),y(7,"p-dropdown",6),o(),i(8,"div",5),y(9,"p-calendar",7),o(),i(10,"div",5),y(11,"input",8),o(),i(12,"div",5),y(13,"p-button",9),i(14,"p-button",10),d("onClick",function(){return t.resetSearch()}),o()()()()(),i(15,"p-table",11),f(16,zi,11,0,"ng-template",12)(17,Li,16,6,"ng-template",13)(18,qi,3,0,"ng-template",14),o()()()(),i(19,"p-dialog",15),E("visibleChange",function(g){return I(t.detailsDialogVisible,g)||(t.detailsDialogVisible=g),g}),d("onHide",function(){return t.hideInvoiceDialog()}),f(20,Ki,1,1,"ng-template",16)(21,Qi,1,0,"ng-template",17),o(),i(22,"edit-invoice",18),d("onHide",function(){return t.closeEditDialog()})("onSubmit",function(g){return t.submitEdit(g)}),o()),r&2&&(a(3),c("toggleable",!0),a(),c("formGroup",t.searchForm),a(3),c("options",t.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(4),c("loading",t.loading()),a(),c("disabled",t.loading()),a(),c("value",t.returnHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",D(28,Wi))("alwaysShowPaginator",!1)("loading",t.loading()),a(4),ae(D(29,ji)),w("visible",t.detailsDialogVisible),c("modal",!0)("closable",!0)("maximizable",!0),a(3),c("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("customers",t.customers())("return_invoice_edit",!0))},dependencies:[U,J,K,N,Q,X,Z,W,B,le,R,$,ce,ee,te,O,oe,Xe,k]})}}return n})();var qt=Ie(qe());var Ji=()=>[10,25,50],Xi=()=>({width:"95vw"});function Zi(n,m){n&1&&(i(0,"tr")(1,"th"),s(2,"Action #"),o(),i(3,"th"),s(4,"Datetime"),o(),i(5,"th"),s(6,"Total Cost"),o(),i(7,"th",18),s(8,"Products"),o(),i(9,"th",18),s(10,"Total Qty"),o(),i(11,"th",19),s(12,"Options"),o()())}function en(n,m){if(n&1){let e=x();i(0,"tr")(1,"td"),s(2),o(),i(3,"td"),s(4),o(),i(5,"td"),s(6),v(7,"currency"),o(),i(8,"td",18),s(9),o(),i(10,"td",18),s(11),o(),i(12,"td")(13,"button",20),d("click",function(){let t=u(e).$implicit,l=p();return _(l.showInvoiceDialog(t))}),o()(),i(14,"td")(15,"button",21),d("click",function(){let t=u(e).$implicit,l=p();return _(l.printInvoice(t))}),o()(),i(16,"td")(17,"button",22),d("click",function(){let t=u(e).$implicit,l=p();return _(l.openEditDialog(t))}),o()()()}if(n&2){let e=m.$implicit;a(2),h(e.invoice_number),a(2),h(e.dispose_date),a(2),h(C(7,5,e.total_cost)),a(3),b(" ",e.products_number," "),a(2),b(" ",e.total_count," ")}}function tn(n,m){n&1&&(i(0,"tr")(1,"td",23),s(2,"No Records Found!"),o()())}function nn(n,m){n&1&&(i(0,"tr")(1,"th",26),s(2,"Description"),o(),i(3,"th",27),s(4,"Qty"),o(),i(5,"th",27),s(6,"Cost"),o(),i(7,"th",28),s(8,"Total"),o()())}function on(n,m){if(n&1&&(i(0,"tr")(1,"td"),s(2),o(),i(3,"td"),s(4),o(),i(5,"td"),s(6),v(7,"currency"),o(),i(8,"td"),s(9),v(10,"currency"),o()()),n&2){let e=m.$implicit;a(2),h(e.product_name),a(2),h(e.quantity),a(2),h(C(7,4,e.unit_cost)),a(3),b(" ",C(10,6,e.unit_cost*e.quantity)," ")}}function rn(n,m){if(n&1&&(i(0,"tr"),y(1,"td"),i(2,"td"),s(3),o(),y(4,"td"),i(5,"td"),s(6),v(7,"currency"),o()()),n&2){let e=p(3);a(3),b(" ",e.selectedDispose.total_count," "),a(3),b(" Total: ",C(7,2,e.selectedDispose.total_cost)," ")}}function an(n,m){if(n&1&&(i(0,"p-table",25),f(1,nn,9,0,"ng-template",11)(2,on,11,8,"ng-template",12)(3,rn,8,4,"ng-template",16),o()),n&2){let e=p(2);c("value",e.disposeItems)}}function sn(n,m){if(n&1&&f(0,an,4,1,"p-table",24),n&2){let e=p();c("ngIf",e.disposeItems.length!=0)}}function ln(n,m){if(n&1){let e=x();i(0,"button",29),d("click",function(){u(e);let t=p();return _(t.hideInvoiceDialog())}),o()}}var At=(()=>{class n{constructor(e){this.historyService=e,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.subscriptions=new re,this.disposeHistory=this.historyService.disposeHistory,this.loading=this.historyService.signal_loading,this.searchForm=new se({invoice_number:new M(null),dispose_date:new M(null)}),this.submitSearch()}submitSearch(){this.searchForm.value.dispose_date&&(this.searchForm.value.dispose_date=(0,qt.default)(this.searchForm.value.dispose_date).format("YYYY-MM-DD")),this.historyService.fetchDisposeHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchDisposeHistory(null)}showInvoiceDialog(e){this.selectedDispose=e,this.disposeItems=e.items,this.detailsDialogVisible=!0}printInvoice(e){}printDelivery(e){}openEditDialog(e){this.selectedDispose=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedDispose=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1}submitEdit(e){this.editDialogVisible=!1,this.historyService.fetchDisposeHistory(this.searchForm.value)}static{this.\u0275fac=function(r){return new(r||n)(V(ne))}}static{this.\u0275cmp=P({type:n,selectors:[["app-dispose-history"]],decls:21,vars:24,consts:[[1,"grid","m-1"],[1,"col-12","md:col-8","md:col-offset-2"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","dispose_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["formControlName","invoice_number","type","search","placeholder","Action #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],["dialog_mode","edit",3,"onHide","onSubmit","visible","selected_dispose"],[1,"extra-td"],["colspan","3","width","10%"],["size","small","pButton","","pRipple","","icon","fas fa-eye",1,"p-button-success",3,"click"],["size","small","pButton","","pRipple","","icon","pi pi-print",1,"p-button-secondary",3,"click"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning","disabled","",3,"click"],["colspan","11"],["dataKey","product_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","product_id","styleClass","p-datatable-sm",3,"value"],["width","50%"],["width","10%"],["width","20%"],["pButton","","pRipple","","label","Close","icon","pi pi-times",1,"p-button-secondary",3,"click"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.submitSearch()}),i(5,"div",4)(6,"div",5),y(7,"p-calendar",6),o(),i(8,"div",5),y(9,"input",7),o(),i(10,"div",5),y(11,"p-button",8),i(12,"p-button",9),d("onClick",function(){return t.resetSearch()}),o()()()()(),i(13,"p-table",10),f(14,Zi,13,0,"ng-template",11)(15,en,18,7,"ng-template",12)(16,tn,3,0,"ng-template",13),o()()()(),i(17,"p-dialog",14),E("visibleChange",function(g){return I(t.detailsDialogVisible,g)||(t.detailsDialogVisible=g),g}),d("onHide",function(){return t.hideInvoiceDialog()}),f(18,sn,1,1,"ng-template",15)(19,ln,1,0,"ng-template",16),o(),i(20,"dispose-dialog",17),d("onHide",function(){return t.closeEditDialog()})("onSubmit",function(g){return t.submitEdit(g)}),o()),r&2&&(a(3),c("toggleable",!0),a(),c("formGroup",t.searchForm),a(3),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(4),c("loading",t.loading()),a(),c("disabled",t.loading()),a(),c("value",t.disposeHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",D(22,Ji))("alwaysShowPaginator",!1)("loading",t.loading()),a(4),ae(D(23,Xi)),w("visible",t.detailsDialogVisible),c("modal",!0)("closable",!0)("maximizable",!0),a(3),c("visible",t.editDialogVisible)("selected_dispose",t.selectedDispose))},dependencies:[U,J,K,N,Q,X,Z,W,B,le,R,$,ce,ee,O,oe,Ye,k],styles:[".extra-td[_ngcontent-%COMP%]{display:none}@media (min-width: 960px){.extra-td[_ngcontent-%COMP%]{display:table-cell}}"]})}}return n})();var Gt=(()=>{class n{constructor(){this.api=S(Y),this.notificationService=S(ue),this.http=S(Ve),this.dateService=S(je),this.startDate=z(this.dateService.getStartOfMonth()),this.endDate=z(this.dateService.getCurrentDate()),this.loadingTransactions=z(!1),this.cashTransactions=z([])}startDateChanged(){this.startDate.set(this.dateService.formatDate(this.startDate(),"yyyy-MM-dd"))}getCashTransactions(e,r){this.loadingTransactions.set(!0),e=this.dateService.formatDate(e,"yyyy-MM-dd"),r=this.dateService.formatDate(r,"yyyy-MM-dd"),this.http.get(`${this.api.host}/balance/transactions/${e}&${r}`).subscribe({next:t=>{this.cashTransactions.set(t),this.loadingTransactions.set(!1)},error:t=>{this.notificationService.handleError(t.error,"home"),this.loadingTransactions.set(!1)}})}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275prov=Ee({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var cn=(n,m)=>({"text-300":n,"text-green-600":m}),mn=(n,m)=>({"text-300":n,"text-red-600":m}),pn=(n,m,e)=>({"text-red-600":n,"text-green-600":m,"font-bold":e}),dn=(n,m)=>({"text-red-600":n,"text-green-600":m});function un(n,m){if(n&1){let e=x();i(0,"label",6),s(1,"Start Date"),o(),i(2,"p-calendar",7),E("ngModelChange",function(t){u(e);let l=p();return I(l.startDate,t)||(l.startDate=t),_(t)}),d("onSelect",function(){u(e);let t=p();return _(t.startDateChanged())}),o(),i(3,"label",8),s(4,"End Date"),o(),i(5,"p-calendar",7),E("ngModelChange",function(t){u(e);let l=p();return I(l.endDate,t)||(l.endDate=t),_(t)}),d("onSelect",function(){u(e);let t=p();return _(t.endDateChanged())}),o()}if(n&2){let e=p();a(2),w("ngModel",e.startDate),c("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input"),a(3),w("ngModel",e.endDate),c("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input")}}function _n(n,m){if(n&1){let e=x();i(0,"p-button",9),d("onClick",function(){u(e);let t=p();return _(t.selectToday())}),o(),i(1,"p-button",10),d("onClick",function(){u(e);let t=p();return _(t.selectThisMonth())}),o(),i(2,"p-button",11),d("onClick",function(){u(e);let t=p();return _(t.selectThisYear())}),o()}n&2&&(c("size","small"),a(),c("size","small"),a(),c("size","small"))}function hn(n,m){n&1&&(i(0,"tr")(1,"th",12),s(2,"Date"),o(),i(3,"th",12),s(4,"Transaction"),o(),i(5,"th",12),s(6,"Description"),o(),i(7,"th",12),s(8,"Notes"),o(),i(9,"th",12),s(10,"Debit"),o(),i(11,"th",12),s(12,"Credit"),o(),i(13,"th",13),s(14,"Balance"),o()())}function gn(n,m){if(n&1&&(i(0,"tr")(1,"td"),s(2),o(),i(3,"td"),s(4),o(),i(5,"td"),s(6),o(),i(7,"td"),s(8),o(),i(9,"td",14),s(10),v(11,"currency"),o(),i(12,"td",14),s(13),v(14,"currency"),o(),i(15,"td",14),s(16),v(17,"currency"),o()()),n&2){let e=m.$implicit,r=m.rowIndex,t=p();a(2),b(" ",e.journal_date||"Before "+t.startDate()," "),a(2),h(e.journal_number||"---"),a(2),b(" ",e.journal_description||"---"," "),a(2),b(" ",e.notes||"---"," "),a(),c("ngClass",de(16,cn,e.debit==0,e.debit!=0)),a(),b(" ",C(11,10,e.debit)," "),a(2),c("ngClass",de(19,mn,e.credit==0,e.credit!=0)),a(),b(" ",C(14,12,e.credit)," "),a(2),c("ngClass",ht(22,pn,t.balances[r]<0,t.balances[r]>0,t.balances[r]==0)),a(),b(" ",C(17,14,t.balances[r])," ")}}function fn(n,m){if(n&1&&(i(0,"tr"),y(1,"td",15),i(2,"td"),s(3,"Balance Due"),o(),i(4,"td",16),s(5),v(6,"currency"),o(),i(7,"td",17),s(8),v(9,"currency"),o(),i(10,"td",14),s(11),v(12,"currency"),o()()),n&2){let e=p();a(5),b(" ",C(6,4,e.totalDebit)," "),a(3),b(" ",C(9,6,e.totalCredit)," "),a(2),c("ngClass",de(10,dn,e.balances[e.balances.length-1]<0,e.balances[e.balances.length-1]>0)),a(),b(" ",C(12,8,e.balances[e.balances.length-1])," ")}}var tt=(()=>{class n{constructor(){this.transactionService=S(Gt),this.fb=S(Fe),this.dateService=S(je),this.decimalService=S(he),this.loadingTransactions=this.transactionService.loadingTransactions,this.cashTransactions=this.transactionService.cashTransactions,this.startDate=this.transactionService.startDate,this.endDate=this.transactionService.endDate,this.balances=[],this.totalDebit=0,this.totalCredit=0,this.submitSearch(),gt(()=>{let e=this.cashTransactions();if(e.length>0){this.balances=[],this.balances[0]=parseFloat(e[0].balance);for(let r=1;r<e.length;r++)this.balances[r]=this.balances[r-1]+parseFloat(e[r].debit)-parseFloat(e[r].credit);this.calculateTotals(e)}else this.balances=[]})}submitSearch(){this.transactionService.getCashTransactions(this.startDate(),this.endDate())}startDateChanged(){this.transactionService.startDateChanged(),this.submitSearch()}endDateChanged(){this.submitSearch()}selectToday(){this.transactionService.startDate.set(this.dateService.getCurrentDate()),this.transactionService.endDate.set(this.dateService.getCurrentDate()),this.submitSearch()}selectThisMonth(){this.transactionService.startDate.set(this.dateService.getStartOfMonth()),this.transactionService.endDate.set(this.dateService.getEndOfMonth()),this.submitSearch()}selectThisYear(){this.transactionService.startDate.set(this.dateService.getStartOfYear()),this.transactionService.endDate.set(this.dateService.getEndOfYear()),this.submitSearch()}calculateTotals(e){this.totalDebit=0,this.totalCredit=0;for(let r=1;r<e.length;r++)this.totalDebit=this.decimalService.add(this.totalDebit,parseFloat(e[r].debit)),this.totalCredit=this.decimalService.add(this.totalCredit,parseFloat(e[r].credit))}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=P({type:n,selectors:[["cash-transactions"]],standalone:!0,features:[_t],decls:8,vars:2,consts:[["pTemplate","left"],["pTemplate","right"],["dataKey","account_number","styleClass","p-datatable-sm","scrollHeight","68vh",1,"ledger_table",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[1,"mr-2"],["styleClass","p-inputtext-sm","dateFormat","yy-mm-dd",3,"ngModelChange","onSelect","ngModel","showIcon","readonlyInput","showButtonBar","required","iconDisplay"],[1,"ml-5","mr-2"],["label","Today","severity","secondary",3,"onClick","size"],["styleClass","mx-2","label","This Month","severity","secondary",3,"onClick","size"],["label","This Year","severity","secondary",3,"onClick","size"],["width","15%"],["width","10%"],[3,"ngClass"],["colspan","3"],[1,"text-green-600"],[1,"text-red-600"]],template:function(r,t){r&1&&(i(0,"p-card")(1,"p-toolbar"),f(2,un,6,12,"ng-template",0)(3,_n,3,3,"ng-template",1),o(),i(4,"p-table",2),f(5,hn,15,0,"ng-template",3)(6,gn,18,26,"ng-template",4)(7,fn,13,13,"ng-template",5),o()()),r&2&&(a(4),c("value",t.cashTransactions())("scrollable",!0))},dependencies:[Be,$,B,Ke,$e,We,O,R,ze,W,Ne,k,Oe,ke,N,yt,Me,He,Pe,Ge,It]})}}return n})();var Ut=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=P({type:n,selectors:[["app-cash-history"]],decls:3,vars:0,consts:[[1,"grid","m-1"],[1,"col-12"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1),y(2,"cash-transactions"),o()())},dependencies:[tt]})}}return n})();var vn=()=>[10,25,50];function Cn(n,m){n&1&&(i(0,"tr")(1,"th",17),s(2,"Code"),o(),i(3,"th",18),s(4,"Product Name"),o(),i(5,"th",19),s(6,"Invoice #"),o(),i(7,"th",19),s(8,"Customer"),o(),i(9,"th",20),s(10,"Datetime"),o(),i(11,"th",19),s(12,"Unit Price"),o(),i(13,"th",21),s(14,"Qty"),o(),i(15,"th",19),s(16,"Total"),o()())}function bn(n,m){if(n&1&&(i(0,"tr")(1,"td"),s(2),o(),i(3,"td"),s(4),o(),i(5,"td"),s(6),o(),i(7,"td"),s(8),o(),i(9,"td"),s(10),o(),i(11,"td"),s(12),v(13,"currency"),o(),i(14,"td"),s(15),o(),i(16,"td"),s(17),v(18,"currency"),o()()),n&2){let e=m.$implicit;a(2),h(e.sku||"---"),a(2),h(e.product_name),a(2),h(e.invoice_number),a(2),h(e.customer_name),a(2),h(e.order_datetime),a(2),h(C(13,8,e.unit_price)),a(3),h(e.quantity),a(2),h(C(18,10,e.total_price))}}function Sn(n,m){n&1&&(i(0,"tr")(1,"td",22),s(2,"No Records Found!"),o()())}var Yt=(()=>{class n{constructor(){this.historyService=S(ne),this.fb=S(Fe),this.api=S(Y),this.customersService=S(ie),this.authService=S(_e),this.stockService=this.authService.isAdmin()?S(Ae):S(Re),this.products=this.stockService.getProducts(),this.customers=this.customersService.customers,this.productsHistory=z([]),this.searchForm=this.fb.group({customer_id:[null],product_id:[null],invoice_number:[null],invoice_date:[null]}),this.loading=!1,this.fetchProductHistory()}fetchProductHistory(){this.loading=!0,this.api.post("history/products/search",this.searchForm.value).pipe(lt(()=>{this.loading=!1})).subscribe(e=>{this.productsHistory.set(e)})}resetSearch(){this.searchForm.reset(),this.fetchProductHistory()}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=P({type:n,selectors:[["app-products-history"]],decls:21,vars:25,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","product_id","styleClass","p-inputtext-sm w-full","id","product","appendTo","body","optionLabel","product_name","optionValue","product_id","placeholder","Select Product","filterBy","product_name",3,"onChange","options","filter","showClear","autoOptionFocus","virtualScroll","virtualScrollItemSize"],[1,"col-12","md:col-6","lg:col-2"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full",3,"ngModelChange"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"onChange","options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"onChange","showIcon","showClear","readonlyInput"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["width","12%"],["width","30%"],["width","10%"],["width","13%"],["width","5%"],["colspan","11"]],template:function(r,t){r&1&&(i(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),d("ngSubmit",function(){return t.fetchProductHistory()}),i(5,"div",4)(6,"div",5)(7,"p-dropdown",6),d("onChange",function(){return t.fetchProductHistory()}),o()(),i(8,"div",7)(9,"input",8),d("ngModelChange",function(){return t.fetchProductHistory()}),o()(),i(10,"div",7)(11,"p-dropdown",9),d("onChange",function(){return t.fetchProductHistory()}),o()(),i(12,"div",7)(13,"p-calendar",10),d("onChange",function(){return t.fetchProductHistory()}),o()(),i(14,"div",5),y(15,"p-button",11),i(16,"p-button",12),d("onClick",function(){return t.resetSearch()}),o()()()()(),i(17,"p-table",13),f(18,Cn,17,0,"ng-template",14)(19,bn,19,12,"ng-template",15)(20,Sn,3,0,"ng-template",16),o()()()()),r&2&&(a(3),c("toggleable",!0),a(),c("formGroup",t.searchForm),a(3),c("options",t.products())("filter",!0)("showClear",!0)("autoOptionFocus",!1)("virtualScroll",!0)("virtualScrollItemSize",38),a(4),c("options",t.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(2),c("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(2),c("loading",t.loading),a(),c("disabled",t.loading),a(),c("value",t.productsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",D(24,vn))("alwaysShowPaginator",!1)("loading",t.loading))},dependencies:[J,K,N,Q,X,Z,W,B,R,$,ee,te,O,oe,k]})}}return n})();var xn=[{path:"sales-history",data:{breadcrumb:"sales"},component:Ot},{path:"products-history",data:{breadcrumb:"Products"},component:Yt},{path:"payment-history",data:{breadcrumb:"payments"},component:jt},{path:"return-history",data:{breadcrumb:"returns"},component:Lt},{path:"dispose-history",data:{breadcrumb:"dispose"},component:At},{path:"cash-history",data:{breadcrumb:"Cash"},component:Ut}],Kt=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=De({type:n})}static{this.\u0275inj=Te({imports:[rt.forChild(xn),rt]})}}return n})();var Br=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=De({type:n})}static{this.\u0275inj=Te({imports:[He,Kt,ke,vt,Ue,ze,Ne,Be,Ct,$e,Ge,Oe,We,Ke,Vt,St,Mt,Tt,Pt,Le,Ye,tt]})}}return n})();export{Br as HistoryModule};
