import{a as De}from"./chunk-2QWHM3DI.js";import{a as xe}from"./chunk-6HTKW57C.js";import{c as me}from"./chunk-HT3JZ6CO.js";import{a as we}from"./chunk-LHXBPRE2.js";import{a as he,b as fe}from"./chunk-7PIM7VCW.js";import{a as Ce}from"./chunk-GSMGX6RX.js";import{F as Se,i as ue,j as de,l as _e,m as ge,p as ye,q as be,r as ve}from"./chunk-DNVA5LVB.js";import{b as Y,c as J}from"./chunk-SFMGPKFH.js";import{$b as H,$c as pe,Ba as b,Ca as p,Da as m,Fc as re,G as h,Gc as le,H as q,Ia as E,Ic as se,Ja as V,Ka as I,Ma as l,N as A,Na as D,O as _,Oa as u,P as g,Qa as N,Ra as L,Sa as $,Sb as G,T as w,Ua as j,Va as S,_c as ce,aa as o,cb as v,db as x,fc as P,ha as F,hc as K,ic as X,ka as y,ma as s,mc as Z,oc as ee,pa as M,pc as te,qc as ie,rc as ne,sb as U,sc as ae,tc as oe,v as k,va as n,vb as O,wa as i,xa as C,xb as Q}from"./chunk-E4UPHNBD.js";import{h as W}from"./chunk-WWX6BADO.js";var Ve=["amountInput"],Ie=["customerDropdown"],Te=["paymentDateCalendar"],Be=()=>({width:"75vw"}),ke=()=>({"1199px":"85vw","575px":"95vw"}),Fe=()=>({width:"50vw"}),Me=()=>({"1199px":"75vw","575px":"100vw"});function Ne(a,f){if(a&1){let e=b();n(0,"p-button",20),p("onClick",function(){_(e);let t=m(2);return g(t.submitAllBalance())}),i()}a&2&&s("label","Submit All Balance")}function Le(a,f){if(a&1&&(n(0,"div",21)(1,"div",22)(2,"table",23)(3,"tr")(4,"th",24),l(5),i(),n(6,"th")(7,"text-with-loading",25)(8,"span"),l(9),v(10,"currency"),i()()()(),n(11,"tr")(12,"th",24),l(13),i(),n(14,"th"),l(15),v(16,"currency"),i()(),n(17,"tr")(18,"td",26),C(19,"p-divider",27),i()(),n(20,"tr")(21,"th",24),l(22),i(),n(23,"th")(24,"text-with-loading",28)(25,"span"),l(26),v(27,"currency"),i()()()()()()()),a&2){let e=m(2);o(5),u(" ","Old Balance"," "),o(2),s("isLoading",e.customer_balance_loading())("loadingBar",!0),o(2),D(x(10,10,e.customer_balance().balance)),o(4),u(" ","Payment"," "),o(2),u(" ",x(16,12,e.f.amount.value||0)," "),o(7),u(" ","Remaining"," "),o(2),s("isLoading",e.customer_balance_loading())("loadingBar",!0),o(2),D(x(27,14,e.calculateNewBalance(e.customer_balance().balance,e.f.amount.value||0)))}}function $e(a,f){if(a&1){let e=b();n(0,"form",7),p("ngSubmit",function(){_(e);let t=m();return g(t.submitPayment())}),n(1,"div",8)(2,"div",9)(3,"div",10)(4,"label",11),l(5),n(6,"span",12),l(7," *"),i()(),n(8,"p-dropdown",13),p("ngModelChange",function(){_(e);let t=m();return g(t.getCustomerBalance())}),i()()(),n(9,"div",9)(10,"label",14),l(11),n(12,"span",12),l(13," *"),i()(),C(14,"p-calendar",15,0),i(),n(16,"div",9)(17,"div",10)(18,"label",16),l(19),n(20,"span",12),l(21," *"),i()(),C(22,"p-inputNumber",17,1),y(24,Ne,1,1,"p-button",18),i()()()(),y(25,Le,28,16,"div",19)}if(a&2){let e=m();s("formGroup",e.paymentForm),o(5),D("Customer"),o(3),s("options",e.customers())("placeholder","Select Customer")("required",!0)("filter",!0)("showClear",!0)("autoOptionFocus",!1),o(3),u(" ","Payment Date"," "),o(3),s("showIcon",!1)("showClear",!1)("readonlyInput",!0)("placeholder","Date")("showTime",!0)("showSeconds",!0),o(5),D("Amount"),o(3),s("required",!0)("autofocus",e.account_id)("step",1)("min",0),o(2),s("ngIf",e.mode==="add"),o(),s("ngIf",e.mode==="add")}}function ze(a,f){if(a&1){let e=b();n(0,"p-button",32),p("onClick",function(){_(e);let t=m(2);return g(t.deletePayment())}),i()}if(a&2){let e=m(2);s("label","Delete")("disabled",e.submitLoading)}}function Re(a,f){if(a&1){let e=b();y(0,ze,1,2,"p-button",29),n(1,"p-button",30),p("onClick",function(){_(e);let t=m();return g(t.closeDialog())}),i(),n(2,"p-button",31),p("onClick",function(){_(e);let t=m();return g(t.submitPayment())}),i()}if(a&2){let e=m();s("ngIf",e.mode==="edit"),o(),s("label","Cancel")("disabled",e.submitLoading),o(),s("label","Submit")("loading",e.submitLoading)}}function We(a,f){if(a&1&&(n(0,"div",21)(1,"div",33)(2,"p",34)(3,"strong"),l(4,"Payment #:"),i(),l(5),i(),n(6,"p",34)(7,"strong"),l(8,"Customer:"),i(),l(9),i(),n(10,"p",34)(11,"strong"),l(12,"Date:"),i(),l(13),i()()(),C(14,"p-divider",35),n(15,"div",36)(16,"div",33)(17,"strong"),l(18,"Payment Amount: "),i(),l(19),v(20,"currency"),C(21,"br"),n(22,"strong"),l(23,"Remaining Balance: "),i(),l(24),v(25,"currency"),i()()),a&2){let e=m();o(5),u(" ",e.receiptData.journal_number," "),o(4),u(" ",e.receiptData.customer_name," "),o(4),u("",e.receiptData.payment_date," "),o(6),u(" ",x(20,5,e.appliedPayment())," "),o(5),u(" ",x(25,7,e.remainingBalance().balance)," ")}}function qe(a,f){if(a&1){let e=b();n(0,"p-button",40),p("onClick",function(){_(e);let t=m(2);return g(t.thermalPrint())}),i()}}function Ae(a,f){if(a&1){let e=b();n(0,"p-button",37),p("onClick",function(){_(e);let t=m();return g(t.sendWhatsapp())}),i(),y(1,qe,1,0,"p-button",38),n(2,"p-button",39),p("onClick",function(){_(e);let t=m();return g(t.receiptDialogVisible.set(!1))}),i()}if(a&2){let e=m();o(),s("ngIf",e.isWeb)}}var Dt=(()=>{class a{constructor(){this.customersService=h(De),this.confirmationService=h(G),this.dateService=h(Ce),this.decimalService=h(xe),this.fb=h(ne),this.apiService=h(J),this.notificationService=h(Y),this.isWeb=!window.electron,this.visible=!1,this.mode="add",this.account_id=null,this.visibleChange=new w,this.onCreate=new w,this.onUpdate=new w,this.onDelete=new w,this.customers=this.customersService.customers,this.paymentForm=this.fb.group({journal_id:[null],account_id:[null,P.required],payment_date:[null,P.required],amount:[null,[P.required,P.min(.01)]]}),this.submitLoading=!1,this.customer_balance_loading=this.customersService.signal_balanceLoading,this.customer_balance=this.customersService.customersTotalDebts$,this.receiptDialogVisible=F(!1),this.receiptData=null,this.remainingBalance=this.customersService.customersTotalDebts$,this.appliedPayment=F(0)}get f(){return this.paymentForm.controls}ngOnChanges(e){e.visible&&this.visible&&(this.mode=="edit"?this.paymentForm.patchValue(this.payment):(this.paymentForm.reset({account_id:this.account_id,payment_date:this.dateService.getFullDatetime()}),this.getCustomerBalance()))}closeDialog(){this.submitLoading=!1,this.visibleChange.emit(!1)}submitAllBalance(){this.paymentForm.patchValue({amount:this.customer_balance().balance})}submitPayment(){if(this.paymentForm.valid){let e=this.paymentForm.getRawValue();this.appliedPayment.set(e.amount),this.submitLoading=!0,(this.mode=="add"?this.apiService.post("payment/customer",e):this.apiService.put("payment/customer",e)).pipe(k(()=>{this.submitLoading=!1})).subscribe({next:t=>W(this,null,function*(){yield this.customersService.getAccountTotalBalance(t.customer_id),this.mode=="add"?this.onCreate.emit(t):this.onUpdate.emit(t),this.closeDialog(),this.notificationService.showSuccess(),console.log(t),this.receiptDialogVisible.set(!0),this.receiptData=t})})}else!this.f.amount.value||this.f.amount.value>0?this.amountInput.el.nativeElement.children[0].children[0].focus():this.f.account_id.value?this.paymentDateCalendar.inputfieldViewChild.nativeElement.focus():this.customerDropdown.applyFocus()}deletePayment(){this.confirmationService.confirm({key:"home",message:"Are you sure you want to continue ?",header:"Warning",acceptLabel:"Yes",rejectLabel:"No",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.submitLoading=!0,this.apiService.delete(`payment/${this.payment.journal_id}`).pipe(k(()=>{this.submitLoading=!1})).subscribe({next:()=>{this.notificationService.showSuccess(),this.onDelete.emit(this.payment)}})}})}getCustomerBalance(){this.f.amount.setValue(null),this.f.account_id.value?this.customersService.getAccountTotalBalance(this.f.account_id.value):this.customer_balance.set({id:0,balance:"0"})}calculateNewBalance(e=0,r=0){return e=parseFloat(e),this.decimalService.subtract(e,r)}sendWhatsapp(){let e=this.appliedPayment()||0,r=this.remainingBalance().balance||0,t=this.receiptData.customer_name,T=`961${this.receiptData.customer_phone.replace(/\s+/g,"").replace(/^0/,"")}`,z=`
Payment #: ${this.receiptData.journal_number}
Customer: ${t}
Date: ${this.receiptData.payment_date}

Payment Amount: $${e}
Remaining Balance: $${r}`,B=`https://wa.me/${T}?text=${encodeURIComponent(z.trim())}`;window.open(B,"_blank")}thermalPrint(){let e=this.appliedPayment()||0,r=this.remainingBalance().balance||0,t=this.receiptData.customer_name,c=this.receiptData.journal_number,d=this.receiptData.payment_date,T=32,B=`
    ${(R=>{let Ee=Math.floor((T-R.length)/2);return" ".repeat(Math.max(Ee,0))+R})("*** PAYMENT RECEIPT ***")}



Receipt #: ${c}
Customer: ${t}
Date: ${d}
-------------------------------
Payment Amount:  $${e}
Remaining Balance: $${r}
-------------------------------`,Pe="rawbt:"+encodeURIComponent(B.trim());window.location.href=Pe}static{this.\u0275fac=function(r){return new(r||a)}}static{this.\u0275cmp=q({type:a,selectors:[["payment-dialog"]],viewQuery:function(r,t){if(r&1&&(E(Ve,5),E(Ie,5),E(Te,5)),r&2){let c;V(c=I())&&(t.amountInput=c.first),V(c=I())&&(t.customerDropdown=c.first),V(c=I())&&(t.paymentDateCalendar=c.first)}},inputs:{visible:"visible",mode:"mode",account_id:"account_id",payment:"payment",currency:"currency"},outputs:{visibleChange:"visibleChange",onCreate:"onCreate",onUpdate:"onUpdate",onDelete:"onDelete"},standalone:!0,features:[A,j],decls:6,vars:19,consts:[["paymentDateCalendar",""],["amountInput",""],["position","top","styleClass","p-fluid",3,"visibleChange","onHide","header","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],["position","top",3,"visibleChange","visible","modal","breakpoints","maximizable"],["pTemplate","body"],[3,"ngSubmit","formGroup"],[1,"formgrid","grid"],[1,"field","col-12","md:col-4","lg:col-3"],[1,"flex","flex-column","gap-2"],["for","customer"],[1,"text-red-500"],["id","customer","formControlName","account_id","styleClass","p-inputtext-sm","appendTo","body","optionLabel","name","optionValue","account_id","filterBy","name",3,"ngModelChange","options","placeholder","required","filter","showClear","autoOptionFocus"],["for","payment_date"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","appendTo","body","dateFormat","yy-mm-dd",3,"showIcon","showClear","readonlyInput","placeholder","showTime","showSeconds"],["for","amount"],["styleClass","input-align-center","formControlName","amount","mode","currency","currency","USD","locale","en-US","autoSelect","",1,"p-inputtext-sm",3,"required","autofocus","step","min"],["size","small","severity","contrast",3,"label","onClick",4,"ngIf"],["class","grid",4,"ngIf"],["size","small","severity","contrast",3,"onClick","label"],[1,"grid"],[1,"col-6","align-self-center"],[1,"text-left"],[1,"text-green-500"],["loaderClass","flex-grow-1 flex-shrink-1",2,"width","50%",3,"isLoading","loadingBar"],["colspan","2"],["styleClass","m-0"],["loaderClass","flex-grow-1 flex-shrink-1",2,"width","63%",3,"isLoading","loadingBar"],["icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0","size","small",3,"label","disabled","onClick",4,"ngIf"],["icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","label","disabled"],["icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","label","loading"],["icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0","size","small",3,"onClick","label","disabled"],[1,"col-12"],[1,"m-0"],["styleClass","mt-0"],[1,"grid","flex","mt-1"],["label","Whatsapp","icon","pi pi-whatsapp","severity","success","size","small",3,"onClick"],["label","Print","icon","pi pi-print","severity","contrast","size","small",3,"onClick",4,"ngIf"],["label","Close","icon","pi pi-times","severity","secondary","size","small",3,"onClick"],["label","Print","icon","pi pi-print","severity","contrast","size","small",3,"onClick"]],template:function(r,t){r&1&&(n(0,"p-dialog",2),$("visibleChange",function(d){return L(t.visible,d)||(t.visible=d),d}),p("onHide",function(){return t.closeDialog()}),y(1,$e,26,22,"ng-template",3)(2,Re,3,5,"ng-template",4),i(),n(3,"p-dialog",5),$("visibleChange",function(d){return L(t.receiptDialogVisible,d)||(t.receiptDialogVisible=d),d}),y(4,We,26,9,"ng-template",6)(5,Ae,3,1,"ng-template",4),i()),r&2&&(M(S(15,Be)),s("header","Receive Payment")("modal",!0),N("visible",t.visible),s("breakpoints",S(16,ke))("closeOnEscape",!1)("closable",!0)("maximizable",!0),o(3),M(S(17,Fe)),N("visible",t.receiptDialogVisible),s("modal",!0)("breakpoints",S(18,Me))("maximizable",!0))},dependencies:[pe,ce,H,le,re,se,ge,_e,de,ue,ve,Q,U,O,ae,Z,K,X,ie,oe,ee,te,be,ye,me,fe,he,we,Se]})}}return a})();export{Dt as a};
