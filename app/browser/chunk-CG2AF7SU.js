import{a as pt,b as ut,c as dt,d as _t}from"./chunk-5QXBBOVC.js";import"./chunk-NVX7LJGS.js";import{a as Ze}from"./chunk-4ZXNNEYL.js";import{a as Qe}from"./chunk-2QWHM3DI.js";import{a as St}from"./chunk-6AMBXUQL.js";import{c as W}from"./chunk-HT3JZ6CO.js";import{a as q}from"./chunk-XNAPTIXL.js";import{a as he}from"./chunk-6Y6CAQXE.js";import{b as Le}from"./chunk-CK6XGA6X.js";import{a as et}from"./chunk-I4Y3OHQI.js";import{a as Pe}from"./chunk-E67DLZTH.js";import"./chunk-OWTGQR6U.js";import"./chunk-MB5UDTNQ.js";import{a as it,b as nt}from"./chunk-IZUVX76I.js";import{b as st}from"./chunk-K5EGCQLI.js";import{a as lt,b as at}from"./chunk-IY5RNTTX.js";import{a as ot,b as rt}from"./chunk-GOLNOKOZ.js";import{b as Be}from"./chunk-C5S2HPP5.js";import"./chunk-425U57QI.js";import{a as Ue,b as Ae}from"./chunk-7PIM7VCW.js";import{a as ct,b as mt}from"./chunk-X55XG56Y.js";import"./chunk-3NTPSQLE.js";import{b as tt}from"./chunk-7LKCTRLS.js";import"./chunk-MEVQH5BX.js";import{A as Ye,B as Je,F as Xe,i as We,j as qe,l as je,m as Oe,p as ze,q as Ke,v as Ge,z as $e}from"./chunk-DNVA5LVB.js";import{b as L,c as ge}from"./chunk-SFMGPKFH.js";import{$b as _e,$c as De,Ba as y,C as Y,Ca as _,D as H,Da as s,Ec as Re,Fc as ke,G as E,Gc as Fe,H as J,I as P,Ia as ie,Ic as He,Ja as ne,Ka as oe,La as re,Ma as m,Na as V,Nb as z,O as p,Oa as C,P as u,Qa as w,Ra as S,Sa as T,Sb as de,Va as M,Wa as I,Xa as le,_c as Ne,a as $,aa as a,ba as R,cb as x,d as U,db as b,fc as N,ha as B,hc as fe,ic as Ce,jc as ve,ka as h,kc as D,lc as ye,ma as c,mc as xe,oc as be,pa as k,pc as we,qa as A,qb as ae,ra as X,rb as se,rc as Se,sa as Z,sb as ce,sc as Te,ta as ee,tc as Ie,ua as te,uc as Ee,va as o,vb as me,vc as Me,wa as r,xa as v,xb as pe,yc as Ve,zb as ue}from"./chunk-E4UPHNBD.js";import{a as j,b as O,g as wt}from"./chunk-WWX6BADO.js";var Ct=wt(St());var F=class{constructor(){this.cost_dollar=0,this.subtotal_dollar=0,this.total_dollar=0,this.discount_dollar=0,this.discount2_dollar=0,this.total_dollar_discount_2=0,this.vat_dollar=0,this.total_qty=0}},K=function(i){return i.unit_price_usd="unit_price_usd",i.whole_price_usd="whole_price_usd",i.grandwhole_price_usd="grandwhole_price_usd",i}(K||{});var gt=(()=>{class i{constructor(){this.http=E(ue),this.apiService=E(ge),this.notificationService=E(L),this.expensesService=E(Ze),this.currentInvoice=B({}),this.signal_submited=B(!1),this.signal_submit_loading=B(!1),this.reset$=new U(!1),this.selectedCustomerLatestItems=new U([])}getCustomerLatestPurchase(e){this.http.get(`${this.apiService.host}/customers/user/${e}/purchases/latest`).subscribe({next:n=>{this.selectedCustomerLatestItems.next(n)}})}checkout(e,n,t){this.signal_submited.set(!0),this.signal_submit_loading.set(!0);let l=null;n&&(l={amount:n,customer_id:e.customer_id,payment_date:e.order_datetime}),this.http.post(`${this.apiService.host}/return`,{invoice:e,payment:l}).subscribe({next:g=>{this.notificationService.showSuccess("Invoice submitted","home"),n&&this.expensesService.getBalance()},error:g=>{this.notificationService.showError(g.error.message,"home"),this.signal_submit_loading.set(!1)},complete:()=>{t.getItems(),this.currentInvoice.set({}),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.reset$.next(!0)}})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=Y({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var It=["invoiceTable"],ht=()=>({width:"50vw"}),Et=()=>({"1199px":"75vw","575px":"95vw"}),Mt=i=>({"ng-invalid ng-dirty":i}),G=()=>({standalone:!0}),Vt=()=>({width:"100%"}),Rt=i=>({"border-top-1 surface-border":i}),vt=i=>({"text-red-500":i}),kt=()=>({width:"1rem"}),yt=i=>({"dark-hover":i}),ft=i=>({invalid:i}),Ft=(i,d)=>({"text-red-500":i,"text-orange-500":d}),Ht=i=>[i];function Pt(i,d){i&1&&(o(0,"small",56),m(1,"Customer is required."),r())}function Bt(i,d){if(i&1){let e=y();o(0,"div",51)(1,"p-radioButton",57),T("ngModelChange",function(t){p(e);let l=s(2);return S(l.selected_price_type,t)||(l.selected_price_type=t),u(t)}),r(),o(2,"label",58),m(3),r()()}if(i&2){let e=d.$implicit,n=s(2);a(),c("value",e),w("ngModel",n.selected_price_type),c("ngModelOptions",M(6,G))("inputId",e),a(),c("for",e),a(),C(" ",n.getPriceTypeLabel(e)," ")}}function Lt(i,d){if(i&1){let e=y();o(0,"form",41)(1,"div",19)(2,"div",7)(3,"div",42)(4,"label",43),m(5,"Customer"),o(6,"span",44),m(7," *"),r()(),v(8,"p-dropdown",45),h(9,Pt,2,0,"small",46),r()(),o(10,"div",7)(11,"div",47),v(12,"div",48),o(13,"label"),m(14,"Invoice Date"),r(),v(15,"p-calendar",49),r()(),o(16,"div",7)(17,"div",50)(18,"div",51)(19,"p-radioButton",52),T("ngModelChange",function(t){p(e);let l=s();return S(l.selected_price_type,t)||(l.selected_price_type=t),u(t)}),r(),o(20,"label",53),m(21),r()(),ee(22,Bt,4,7,"div",51,Z),r()(),o(24,"div",7)(25,"div",42)(26,"label",54),m(27,"Payment"),r(),o(28,"p-inputNumber",55),T("ngModelChange",function(t){p(e);let l=s();return S(l.payment_amount,t)||(l.payment_amount=t),u(t)}),r()()()()()}if(i&2){let e=s();c("formGroup",e.invoiceForm),a(8),c("loading",e.signal_tableLoading())("options",e.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1)("ngClass",I(21,Mt,(e.customer_id==null?null:e.customer_id.invalid)&&((e.customer_id==null?null:e.customer_id.dirty)||(e.customer_id==null?null:e.customer_id.touched)||e.submited()))),a(),c("ngIf",(e.customer_id==null?null:e.customer_id.invalid)&&((e.customer_id==null?null:e.customer_id.dirty)||(e.customer_id==null?null:e.customer_id.touched)||e.submited())),a(6),c("readonlyInput",!0)("showIcon",!0)("iconDisplay","input"),a(4),w("ngModel",e.selected_price_type),c("ngModelOptions",M(23,G)),a(2),C(" ",e.getPriceTypeLabel("latest")," "),a(),te(e.priceTypes),a(6),k(M(24,Vt)),w("ngModel",e.payment_amount),c("ngModelOptions",M(25,G))("buttonLayout","horizontal")("step",1)("min",0)}}function Nt(i,d){if(i&1&&(o(0,"tr")(1,"td",9)(2,"h3",10),m(3,"Payment:"),r()(),o(4,"td",11)(5,"h3",12),m(6),x(7,"currency"),r()()()),i&2){let e=s();a(6),C(" ",b(7,1,e.payment_amount)," ")}}function Dt(i,d){i&1&&v(0,"i",79)}function Wt(i,d){if(i&1){let e=y();o(0,"div",66)(1,"div",67)(2,"div",68)(3,"i",69),_("click",function(){let t=p(e).index,l=s(3);return u(l.removeRow(t))}),r(),v(4,"br"),o(5,"p-button",70),_("onClick",function(){let t=p(e).$implicit,l=s(3);return u(l.openPriceDialog(t))}),r()(),o(6,"div",71)(7,"div",19)(8,"div",20)(9,"div",72),m(10),r()(),o(11,"div",73)(12,"p",12),m(13),x(14,"currency"),r(),o(15,"p",74),m(16),x(17,"currency"),h(18,Dt,1,0,"i",75),r()(),o(19,"div",76)(20,"p",77),m(21),v(22,"br"),m(23),r(),o(24,"p-inputNumber",78),T("ngModelChange",function(t){let l=p(e).$implicit;return S(l.quantity,t)||(l.quantity=t),u(t)}),_("onFocus",function(t){p(e);let l=s(3);return u(l.select(t.target))})("ngModelChange",function(){let t=p(e).$implicit,l=s(3);return u(l.setQty(t))}),r()()()()()()}if(i&2){let e=d.$implicit,n=d.first,t=s(3);a(),c("ngClass",I(17,Rt,!n)),a(9),C(" ",e.product_name," "),a(3),C(" Cost: ",b(14,13,e.unit_cost)," "),a(2),c("ngClass",I(19,vt,t.parseFloat(e.unit_price)<t.parseFloat(e.unit_cost))),a(),C(" Price: ",b(17,15,e.unit_price)," "),a(2),c("ngIf",t.parseFloat(e.unit_price)<t.parseFloat(e.unit_cost)),a(3),C(" stock: ",e.stock," "),a(2),C(" remain: ",e.stock-e.quantity," "),a(),k(M(21,kt)),w("ngModel",e.quantity),c("showButtons",!0)("step",1)}}function qt(i,d){if(i&1){let e=y();o(0,"p-messages",80),T("valueChange",function(t){p(e);let l=s(3);return S(l.messages,t)||(l.messages=t),u(t)}),r()}if(i&2){let e=s(3);w("value",e.messages),c("enableService",!1)("closable",!1)}}function jt(i,d){i&1&&v(0,"p-divider")}function Ot(i,d){if(i&1){let e=y();o(0,"div",19),h(1,Wt,25,22,"div",63),o(2,"div",20),h(3,qt,1,3,"p-messages",64)(4,jt,1,0,"p-divider"),r(),o(5,"div",26)(6,"p-autoComplete",65,2),T("ngModelChange",function(t){p(e);let l=s(2);return S(l.search_product,t)||(l.search_product=t),u(t)}),_("completeMethod",function(t){p(e);let l=s(2);return u(l.searchItem(t))})("onKeyUp",function(t){p(e);let l=s(2);return u(l.submitInvoiceInput(t))}),r()(),o(8,"div",28)(9,"p-button",29),_("onClick",function(){p(e);let t=s(2);return u(t.dialog_products_visible=!0)}),r()(),o(10,"div",30)(11,"p-button",31),_("onClick",function(){p(e);let t=s(2);return u(t.clearInvoice())}),r(),o(12,"p-button",32),_("onClick",function(){p(e);let t=s(2);return u(t.checkout())}),r()()()}if(i&2){let e=d.$implicit,n=s(2);a(),c("ngForOf",e),a(2),X(n.order_items.length===0?3:4),a(3),w("ngModel",n.search_product),c("suggestions",n.matching_products)("delay",150),a(5),c("disabled",n.order_items.length==0),a(),c("loading",n.loading())("disabled",n.order_items.length==0)}}function Ut(i,d){if(i&1&&(o(0,"div",59)(1,"p-card",60)(2,"p-dataView",61,3),h(4,Ot,13,8,"ng-template",62),r()()()),i&2){let e=s();a(2),c("value",e.order_items)}}function At(i,d){if(i&1){let e=y();o(0,"tr")(1,"th",81),_("click",function(){p(e);let t=s();return u((t.customer_id==null?null:t.customer_id.value)&&t.toggleExpandAll())}),v(2,"i"),r(),o(3,"th",82),m(4,"Description"),r(),o(5,"th",83),m(6,"Cost"),r(),o(7,"th",83),m(8,"Qty"),r(),o(9,"th",84),m(10,"Unit"),r(),o(11,"th",84),m(12,"Total"),r(),o(13,"th",83),m(14,"Del?"),r()()}if(i&2){let e=s();a(),c("ngClass",I(3,yt,e.customer_id==null?null:e.customer_id.value)),a(),A(e.all_expanded?"pi pi-eye":"pi pi-eye-slash")}}function zt(i,d){if(i&1){let e=y();o(0,"p-inputNumber",92),T("ngModelChange",function(t){p(e);let l=s().$implicit;return S(l.quantity,t)||(l.quantity=t),u(t)}),_("onFocus",function(t){p(e);let l=s(2);return u(l.select(t.target))})("ngModelChange",function(){p(e);let t=s().$implicit,l=s();return u(l.setQty(t))}),r()}if(i&2){let e=s().$implicit;w("ngModel",e.quantity)}}function Kt(i,d){if(i&1&&(o(0,"span",93),m(1),r()),i&2){let e=s().$implicit;c("ngClass",I(2,vt,!e.quantity)),a(),V(e.quantity)}}function Qt(i,d){if(i&1){let e=y();o(0,"p-inputNumber",94),T("ngModelChange",function(t){p(e);let l=s().$implicit;return S(l.unit_price,t)||(l.unit_price=t),u(t)}),_("ngModelChange",function(){p(e);let t=s().$implicit,l=s();return u(l.setPrice(t))})("onFocus",function(t){p(e);let l=s(2);return u(l.select(t.target))}),r()}if(i&2){let e=s().$implicit;w("ngModel",e.unit_price),c("maxFractionDigits",2)("min",0)}}function Gt(i,d){i&1&&v(0,"i",96)}function $t(i,d){if(i&1&&(o(0,"span",93),m(1),x(2,"currency"),o(3,"span"),h(4,Gt,1,0,"i",95),r()()),i&2){let e=s().$implicit,n=s();c("ngClass",le(5,Ft,!e.unit_price,n.getPriceWarining(e))),a(),V(b(2,3,e.unit_price)),a(3),c("ngIf",n.getPriceWarining(e))}}function Yt(i,d){if(i&1){let e=y();o(0,"tr")(1,"td",85),v(2,"i"),r(),o(3,"td"),m(4),r(),o(5,"td"),m(6),x(7,"currency"),r(),o(8,"td",86)(9,"p-cellEditor"),h(10,zt,1,1,"ng-template",87)(11,Kt,2,4,"ng-template",88),r()(),o(12,"td",89)(13,"p-cellEditor"),h(14,Qt,1,3,"ng-template",87)(15,$t,5,8,"ng-template",88),r()(),o(16,"td"),m(17),x(18,"currency"),r(),o(19,"td",90),_("click",function(){let t=p(e).rowIndex,l=s();return u(l.removeRow(t))}),v(20,"i",91),r()()}if(i&2){let e=d.$implicit,n=d.expanded,t=s();a(),c("ngClass",I(16,yt,(t.customer_id==null?null:t.customer_id.value)&&t.getCustomerItemHistory(e)&&t.getCustomerItemHistory(e).length>0))("pRowTogglerDisabled",!(t.customer_id!=null&&t.customer_id.value)||!t.getCustomerItemHistory(e)||t.getCustomerItemHistory(e).length===0)("pRowToggler",e),a(),A(n?"pi pi-eye":"pi pi-eye-slash"),a(2),V(e.product_name),a(2),V(b(7,12,e.unit_cost)),a(2),c("pEditableColumn",e.quantity)("ngClass",I(18,ft,!e.quantity)),a(4),c("pEditableColumn",e.unit_price)("ngClass",I(20,ft,!e.unit_price)),a(5),C(" ",e.currency=="lira"?e.unit_price*e.quantity:b(18,14,e.unit_price*e.quantity)," ")}}function Jt(i,d){i&1&&(o(0,"tr")(1,"th"),m(2,"Latest Price"),r(),o(3,"th"),m(4,"Purchase date"),r()())}function Xt(i,d){if(i&1&&(o(0,"tr")(1,"td"),m(2),x(3,"currency"),r(),o(4,"td"),m(5),r()()),i&2){let e=d.$implicit;a(2),C(" ",b(3,2,e.unit_price)," "),a(3),C(" ",e.order_datetime||" --- "," ")}}function Zt(i,d){if(i&1&&h(0,Xt,6,4,"tr",99),i&2){let e=s().$implicit,n=s();c("ngForOf",n.getCustomerItemHistory(e))}}function ei(i,d){if(i&1&&(o(0,"tr")(1,"td",97)(2,"div",98)(3,"p-table",61),h(4,Jt,5,0,"ng-template",22)(5,Zt,1,1,"ng-template",6),r()()()()),i&2){let e=d.$implicit;a(3),c("value",I(1,Ht,e))}}function ti(i,d){if(i&1&&(o(0,"h4",101),m(1),r()),i&2){let e=s(2);a(),C(" Total units: ",e.invoiceTotal.total_qty," ")}}function ii(i,d){if(i&1&&h(0,ti,2,1,"h4",100),i&2){let e=s();c("ngIf",e.invoiceTotal.total_qty)}}function ni(i,d){i&1&&(o(0,"tr",102)(1,"td",97),m(2,"No data yet!"),r()())}function oi(i,d){if(i&1){let e=y();o(0,"button",103),_("onClick",function(){p(e);let t=s();return u(t.saveAndPrintInvoice())}),r(),o(1,"button",104),_("onClick",function(){p(e);let t=s();return u(t.rejectCheckoutDialog())}),r(),o(2,"button",105),_("onClick",function(){p(e);let t=s();return u(t.confirmCheckoutDialog())}),r()}i&2&&(a(),c("autofocus",!0))}function ri(i,d){i&1&&(o(0,"small",56),m(1,"Price is required!"),r())}function li(i,d){if(i&1){let e=y();o(0,"form",106),_("ngSubmit",function(){p(e);let t=s();return u(t.submitEditPrice())}),o(1,"div",107)(2,"p"),m(3),x(4,"currency"),r(),o(5,"p"),m(6),x(7,"currency"),r(),o(8,"label"),m(9,"New Price"),r(),v(10,"p-inputNumber",108),h(11,ri,2,0,"small",46),r()()}if(i&2){let e=s();c("formGroup",e.editPriceForm),a(3),C("Cost: ",b(4,4,e.selectedUnitCost),""),a(3),C("price: ",b(7,6,e.selectedUnitPrice),""),a(5),c("ngIf",(e.new_price==null?null:e.new_price.invalid)&&((e.new_price==null?null:e.new_price.dirty)||(e.new_price==null?null:e.new_price.touched)||e.submitted))}}function ai(i,d){if(i&1){let e=y();o(0,"button",109),_("click",function(){p(e);let t=s();return u(t.closeEditPrice())}),r(),o(1,"button",110),_("click",function(){p(e);let t=s();return u(t.submitEditPrice())}),r()}if(i&2){let e=s();a(),c("disabled",!e.editPriceForm.valid)}}var xt=(()=>{class i{constructor(e,n,t,l,g){this.returnService=e,this.customersService=n,this.authService=t,this.notificationsService=l,this.confirmationService=g,this.fb=E(Se),this.stockService=this.authService.isAdmin()?E(et):E(Pe),this.invoiceTotal=new F,this.vh="45vh",this.all_expanded=!1,this.search_product=null,this.matching_products=[],this.customers=this.customersService.customers,this.dialog_products_visible=!1,this.customer_balance=this.customersService.customersTotalDebts$,this.customer_balance_loading=this.customersService.signal_balanceLoading,this.payment_amount=0,this.currentInvoice=this.returnService.currentInvoice,this.submited=this.returnService.signal_submited,this.products=this.stockService.getProducts(),this.loading=this.returnService.signal_submit_loading,this.stockTableLoading=this.stockService.tableLoading,this.signal_tableLoading=this.customersService.signal_tableLoading,this.order_items=[],this.subscriptions=new $,this.priceTypes=Object.keys(K),this.today=(0,Ct.default)().format("YYYY-MM-DD"),this.selected_price_type="latest",this.selectedCustomerLatestItems=[],this.invoiceForm=new ve({customer_id:new D(null,N.required),invoice_number:new D(""),order_datetime:new D(this.today,N.required)}),this.editPriceVisible=!1,this.submitted=!1,this.editPriceForm=this.fb.group({new_price:[null,N.required]})}get customer_id(){return this.invoiceForm.get("customer_id")}ngOnInit(){this.messages=[{severity:"info",detail:"No Invoice Yet!"}],this.invoiceForm.patchValue(this.currentInvoice()),this.order_items=this.currentInvoice().items||[],this.calculateTotal("init"),this.subscriptions.add(this.customersService.newOrder$.subscribe(e=>{e&&this.invoiceForm.patchValue({customer_id:e})})),this.subscriptions.add(this.customer_id?.statusChanges.subscribe(e=>{this.customer_id?.value?(this.returnService.getCustomerLatestPurchase(this.customer_id.value),this.customersService.getAccountTotalBalance(this.customer_id.value)):(this.selectedCustomerLatestItems=[],this.all_expanded=!0,this.toggleExpandAll(),this.customer_balance.set({id:0,balance:"0"}))})),this.subscriptions.add(this.returnService.selectedCustomerLatestItems.subscribe(e=>{this.selectedCustomerLatestItems=e})),this.subscriptions.add(this.returnService.reset$.subscribe(e=>{e&&(this.init(),this.returnService.reset$.next(!1))}))}ngOnDestroy(){this.subscriptions.unsubscribe(),this.returnService.currentInvoice.set(O(j({},this.invoiceForm.value),{items:this.order_items}))}setPrice(e){this.calculateTotal("edit")}setQty(e){this.calculateTotal("edit")}select(e){e.select()}getCustomerItemHistory(e){return this.selectedCustomerLatestItems.filter(n=>n.product_id==e.product_id&&n.price_type==e.price_type)}init(){this.order_items=[],this.submited.set(!1),this.invoiceForm.reset({order_datetime:this.today}),this.calculateTotal("init"),this.selected_price_type="latest",this.payment_amount=0}clearInvoice(){this.confirmationService.confirm({key:"home",message:"Are you sure that you want to clear invoice?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.init()}})}saveAndPrintInvoice(){}rejectCheckoutDialog(){}confirmCheckoutDialog(){}searchItem(e){let n=this.products(),t=[],l=e.query;for(let g=0;g<n.length;g++){let f=n[g];f.product_name.toLowerCase().indexOf(l.toLowerCase())>-1&&t.push(f)}this.matching_products=t}addProduct(e){let n=this.order_items.find(t=>t.product_id===e.product_id);if(n)n.quantity+=1,this.calculateTotal("edit");else{let t=0;if(this.selected_price_type==="latest"){let l=this.selectedCustomerLatestItems.find(g=>g.product_id===e.product_id);l&&(console.log("expected",l),t=l.unit_price)}else t=e[this.selected_price_type]||0;this.order_items.push({product_id:e.product_id,product_name:e.product_name,unit_price:t,price_type:this.selected_price_type,stock:e.quantity,quantity:1,unit_cost:e.unit_cost_usd,avg_cost:e.avg_cost_usd}),this.calculateTotal("add")}}submitInvoiceInput(e){e.key==="Enter"&&(typeof this.search_product=="object"&&this.search_product!==null?this.addProduct(this.search_product):this.search_product&&this.notificationsService.showError("Product not found","home"),this.search_product=null)}removeRow(e){this.confirmationService.confirm({key:"home",message:"Are you sure that you want to remove row?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.order_items.splice(e,1),this.calculateTotal("remove"),this.validateItems()}})}assignSelectedProducts(e){this.dialog_products_visible=!1,e.forEach(n=>{this.addProduct(n)})}toggleExpandAll(){this.all_expanded=!this.all_expanded,this.all_expanded?this.order_items.forEach(e=>{this.getCustomerItemHistory(e)&&this.getCustomerItemHistory(e).length>0&&(this.invoiceTable.expandedRowKeys[e.product_id]=!0)}):this.invoiceTable&&setTimeout(()=>{this.invoiceTable.expandedRowKeys={}})}calculateTotal(e){let n=new F,t=this.order_items;return t.length>0&&(t.forEach(l=>{n.total_qty+=l.quantity,n.cost_dollar+=l.unit_cost*l.quantity,n.subtotal_dollar+=l.unit_price*l.quantity}),n.total_dollar=n.subtotal_dollar-n.discount_dollar),this.invoiceTotal=n,n}getPriceTypeLabel(e){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[e]}get new_price(){return this.editPriceForm.get("new_price")}openPriceDialog(e){this.submitted=!1,this.selectedRecord=e,this.selectedUnitCost=e.unit_cost,this.selectedUnitPrice=e.unit_price,this.editPriceVisible=!0}submitEditPrice(){if(this.submitted=!0,this.editPriceForm.valid){let e=this.order_items.findIndex(n=>n.product_id===this.selectedRecord.product_id);this.order_items[e].unit_price=this.editPriceForm.value.new_price,this.closeEditPrice(),this.editPriceForm.reset(),this.calculateTotal("edit")}}closeEditPrice(){this.editPriceForm.reset(),this.editPriceVisible=!1}parseFloat(e){return parseFloat(e)}checkout(){let e=this.validateItems();this.invoiceForm.valid&&!e?this.confirmationService.confirm({key:"home",message:'Are you sure that you want to submit invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-success",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.returnService.checkout(O(j({},this.invoiceForm.value),{total_amount:this.invoiceTotal.total_dollar,total_cost:this.invoiceTotal.cost_dollar,items:this.order_items}),this.payment_amount,this.stockService)}}):(this.submited.set(!0),e&&this.notificationsService.showError("Please enter price for all items","home"))}validateItems(){return!!this.order_items.find(n=>!n.unit_price||!n.quantity)}calculateNewBalance(e,n=0,t=0){return n=parseFloat(n),n-e-t}getPriceWarining(e){if(!e.unit_price)return!1;let n=e.unit_cost||0,t=e.unit_price;return typeof n=="string"&&(n=parseFloat(n)),typeof t=="string"&&(t=parseFloat(t)),t<n}static{this.\u0275fac=function(n){return new(n||i)(R(gt),R(Qe),R(he),R(L),R(de))}}static{this.\u0275cmp=J({type:i,selectors:[["app-return-home"]],viewQuery:function(n,t){if(n&1&&ie(It,5),n&2){let l;ne(l=oe())&&(t.invoiceTable=l.first)}},decls:72,vars:40,consts:[["desktopTable",""],["invoiceTable",""],["barcodeInput",""],["dv",""],[1,"grid","m-1"],[1,"col-12","md:col-9"],["pTemplate","body"],[1,"col-12","md:col-3"],[2,"width","100%"],[1,"text-left"],[1,"m-0","text-green-500"],[1,"text-right"],[1,"m-0"],["loaderClass","flex-grow-1 flex-shrink-1",2,"width","50%",3,"isLoading","loadingBar"],[4,"ngIf"],["colspan","2"],["class","col-12 lg:hidden",4,"ngIf"],[1,"col-12","hidden","lg:block"],["styleClass","mt-2"],[1,"grid"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm ","editMode","cell",3,"value"],["pTemplate","header"],["pTemplate","rowexpansion"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-7","md:col-3","lg:col-2"],["styleClass","w-full","inputStyleClass","w-full","field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm","w-full",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay"],[1,"col-5","md:col-3","lg:col-2"],["label","Multi Select","severity","warning","size","small","icon","pi pi-list","styleClass","w-full",3,"onClick"],[1,"col-12","md:col-6","lg:col-8","text-right"],["label","Clear","icon","pi pi-times","severity","danger","size","small","styleClass","w-full mt-4 md:w-auto md:mt-0",3,"onClick","disabled"],["label","Checkout","icon","pi pi-cart-plus","severity","success","size","small","styleClass","w-full mt-2 md:w-auto md:ml-2 md:mt-0",3,"onClick","loading","disabled"],[3,"target","blocked"],[1,"text-center","custom-content"],[1,"pi","pi-lock",2,"font-size","xx-large"],[3,"onHide","onSubmit","visible","products","price","tableLoading"],["key","checkout"],["pTemplate","footer"],["header","Edit Price","styleClass","p-fluid","position","top",3,"visibleChange","visible","modal","breakpoints","draggable","resizable"],["pTemplate","content"],[3,"formGroup"],[1,"flex","flex-column","gap-2"],["for","customer"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","customer","appendTo","body","formControlName","customer_id","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"loading","options","filter","showClear","autoOptionFocus","ngClass"],["class","p-error",4,"ngIf"],[1,"field"],[1,"flex","flex-column"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","formControlName","order_datetime","dateFormat","yy-mm-dd","size","small",3,"readonlyInput","showIcon","iconDisplay"],[1,"flex","flex-wrap","gap-2","justify-content-between","align-content-center","h-full"],[1,"flex","align-items-center"],["value","latest","inputId","latest",3,"ngModelChange","ngModel","ngModelOptions"],["for","latest",1,"ml-2"],["for","currency"],["inputId","currency-us","mode","currency","currency","USD","locale","en-US",3,"ngModelChange","ngModel","ngModelOptions","buttonLayout","step","min"],[1,"p-error"],[3,"ngModelChange","value","ngModel","ngModelOptions","inputId"],[1,"ml-2",3,"for"],[1,"col-12","lg:hidden"],["styleClass","mt-2 invoice-body"],[3,"value"],["pTemplate","list"],["class","col-12 p-0",4,"ngFor","ngForOf"],["detail","testing",3,"value","enableService","closable"],["inputStyleClass","p-inputtext-sm w-full","field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay"],[1,"col-12","p-0"],[1,"grid","py-2",3,"ngClass"],[1,"col-2","text-center"],[1,"pi","pi-trash","text-red-500","pb-3",2,"font-size","1.3rem",3,"click"],["severity","contrast","icon","pi pi-pencil","size","small",3,"onClick"],[1,"col-10"],[1,"text-lg","font-medium","text-900"],[1,"col-7"],[1,"m-0",3,"ngClass"],["class","pi pi-exclamation-triangle text-red-600",4,"ngIf"],[1,"col-5"],[1,"m-0","text-center"],["min","1","buttonLayout","horizontal","spinnerMode","horizontal","inputId","vertical","decrementButtonClass","p-button-danger small-button","incrementButtonClass","p-button-success small-button","incrementButtonIcon","pi pi-plus","decrementButtonIcon","pi pi-minus",1,"small-input","pl-4","pt-2",3,"ngModelChange","onFocus","ngModel","showButtons","step"],[1,"pi","pi-exclamation-triangle","text-red-600"],["detail","testing",3,"valueChange","value","enableService","closable"],["width","5%",3,"click","ngClass"],["width","40%"],["width","5%"],["width","15%"],[3,"ngClass","pRowTogglerDisabled","pRowToggler"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["min","1","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],[3,"ngClass"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["colspan","9"],[1,"p-2"],[4,"ngFor","ngForOf"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["pButton","","pRipple","","icon","pi pi-print","type","button","label","Save & Print",1,"p-button-secondary","p-button-sm","mr-6",3,"onClick"],["pButton","","pRipple","","pAutoFocus","","icon","pi pi-times","type","button","label","No",1,"p-button-danger","p-button-sm","mr-2",3,"onClick","autofocus"],["pButton","","pRipple","","icon","pi pi-check","type","button","label","Yes",1,"p-button-success","p-button-sm",3,"onClick"],[3,"ngSubmit","formGroup"],[1,"field","mt-1"],["formControlName","new_price","inputId","currency-us","mode","currency","currency","USD","locale","en-US","min","0"],["pButton","","pRipple","","label","Cancel","icon","pi pi-times",1,"p-button-secondary",3,"click"],["pButton","","pRipple","","label","Submit","icon","pi pi-check",1,"p-button-success",3,"click","disabled"]],template:function(n,t){if(n&1){let l=y();o(0,"div",4)(1,"div",5)(2,"p-card"),h(3,Lt,29,26,"ng-template",6),r()(),o(4,"div",7)(5,"p-card")(6,"table",8)(7,"tbody")(8,"tr")(9,"td",9)(10,"h3",10),m(11,"Invoice Total:"),r()(),o(12,"td",11)(13,"h3",12),m(14),x(15,"currency"),r()()(),o(16,"tr")(17,"td",9)(18,"h3",10),m(19,"Old Balance:"),r()(),o(20,"td",11)(21,"h3",12)(22,"text-with-loading",13)(23,"span"),m(24),x(25,"currency"),r()()()()(),h(26,Nt,8,3,"tr",14),o(27,"tr")(28,"td",15),v(29,"p-divider"),r()(),o(30,"tr")(31,"td",9)(32,"h3",10),m(33,"New Balance:"),r()(),o(34,"td",11)(35,"h3",12)(36,"text-with-loading",13)(37,"span"),m(38),x(39,"currency"),r()()()()()()()()(),h(40,Ut,5,1,"div",16),o(41,"div",17)(42,"p-card",18,0)(44,"div",19)(45,"div",20)(46,"p-table",21,1),h(48,At,15,5,"ng-template",22)(49,Yt,21,22,"ng-template",6)(50,ei,6,3,"ng-template",23)(51,ii,1,1,"ng-template",24)(52,ni,3,0,"ng-template",25),r()(),o(53,"div",26)(54,"p-autoComplete",27,2),T("ngModelChange",function(f){return p(l),S(t.search_product,f)||(t.search_product=f),u(f)}),_("completeMethod",function(f){return p(l),u(t.searchItem(f))})("onKeyUp",function(f){return p(l),u(t.submitInvoiceInput(f))}),r()(),o(56,"div",28)(57,"p-button",29),_("onClick",function(){return p(l),u(t.dialog_products_visible=!0)}),r()(),o(58,"div",30)(59,"p-button",31),_("onClick",function(){return p(l),u(t.clearInvoice())}),r(),o(60,"p-button",32),_("onClick",function(){return p(l),u(t.checkout())}),r()()()()()(),o(61,"p-blockUI",33)(62,"div",34),v(63,"i",35),o(64,"h1"),m(65,"choose a customer"),r()()(),o(66,"products-dialog",36),_("onHide",function(){return p(l),u(t.dialog_products_visible=!1)})("onSubmit",function(f){return p(l),u(t.assignSelectedProducts(f))}),r(),o(67,"p-confirmDialog",37),h(68,oi,3,1,"ng-template",38),r(),o(69,"p-dialog",39),T("visibleChange",function(f){return p(l),S(t.editPriceVisible,f)||(t.editPriceVisible=f),u(f)}),h(70,li,12,8,"ng-template",40)(71,ai,2,1,"ng-template",38),r()}if(n&2){let l=re(43);a(14),C(" ",b(15,31,t.invoiceTotal.subtotal_dollar)," "),a(8),c("isLoading",t.customer_balance_loading())("loadingBar",!0),a(2),V(b(25,33,t.customer_balance().balance)),a(2),c("ngIf",t.payment_amount),a(10),c("isLoading",t.customer_balance_loading())("loadingBar",!0),a(2),V(b(39,35,t.calculateNewBalance(t.invoiceTotal.subtotal_dollar,t.customer_balance().balance,t.payment_amount))),a(2),c("ngIf",t.customer_id==null?null:t.customer_id.value),a(6),c("value",t.order_items),a(8),w("ngModel",t.search_product),c("suggestions",t.matching_products)("delay",150),a(5),c("disabled",t.order_items.length==0),a(),c("loading",t.loading())("disabled",t.order_items.length==0),a(),c("target",l)("blocked",!(t.customer_id!=null&&t.customer_id.value)),a(5),c("visible",t.dialog_products_visible)("products",t.products)("price",t.selected_price_type)("tableLoading",t.stockTableLoading()),a(),k(M(37,ht)),a(2),k(M(38,ht)),w("visible",t.editPriceVisible),c("modal",!0)("breakpoints",M(39,Et))("draggable",!1)("resizable",!1)}},dependencies:[ae,se,ce,xe,fe,Ce,ye,be,we,Re,ke,_e,We,ze,Ee,it,Ve,ct,je,Ge,$e,Ye,Je,Ue,ot,q,pt,Ne,lt,dt,W,me],styles:["[_nghost-%COMP%]  .p-card-content{padding:0!important}"]})}}return i})();var si=[{path:"",component:xt}],bt=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=P({type:i})}static{this.\u0275inj=H({imports:[z.forChild(si),z]})}}return i})();var En=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=P({type:i})}static{this.\u0275inj=H({imports:[pe,bt,Te,Ie,Fe,He,qe,Ke,st,Me,nt,mt,Oe,Xe,tt,Ae,rt,q,ut,De,at,_t,Be,Le,W]})}}return i})();export{En as ReturnModule};
