import{a as de}from"./chunk-6HTKW57C.js";import{a as Y}from"./chunk-6Y6CAQXE.js";import{a as Se}from"./chunk-I4Y3OHQI.js";import{a as se}from"./chunk-E67DLZTH.js";import{A as he,B as fe,C as be,D as Ce,F as we,l as le,m as ae,p as pe,q as ce,v as me,w as ue,x as _e,y as ge}from"./chunk-DNVA5LVB.js";import{b as D,c as K}from"./chunk-SFMGPKFH.js";import{$b as G,$c as re,Ba as C,C as V,Ca as u,Da as l,F as g,Fc as ee,G as P,Gc as te,H as F,Hc as ie,Ia as O,Ic as oe,Ja as j,Ka as N,La as T,Ma as _,N as R,Na as W,O as p,Oa as E,P as c,Qa as w,Ra as S,Sa as y,Sb as z,T as I,Ua as B,Va as x,Wa as Q,_c as ne,a as k,aa as d,ba as h,d as M,ha as q,hc as J,ka as f,lc as X,ma as a,pa as L,qb as H,sb as $,sc as Z,va as n,wa as r,xa as b,xb as A,zb as U}from"./chunk-E4UPHNBD.js";var ye=(()=>{class o{constructor(e,t,i,s){this.http=e,this.api=t,this.authService=i,this.notificationService=s,this.signal_submitLoading=q(!1),this.action_status$=new M(null),this.stockService=this.authService.isAdmin()?P(Se):P(se),this.signal_products_loading=this.stockService.tableLoading}disposeItems(e){this.signal_submitLoading.set(!0),this.http.post(`${this.api.host}/user-stock/dispose`,e).subscribe({next:t=>{this.notificationService.showSuccess("Items disposed successfully!","home")},error:t=>{this.notificationService.showError("Failed to dispose items","home"),this.signal_submitLoading.set(!1)},complete:()=>{this.signal_submitLoading.set(!1),this.action_status$.next("dispose"),this.stockService.getItems()}})}deleteDispose(e){this.signal_submitLoading.set(!0),this.http.delete(`${this.api.host}/user-stock/dispose/${e}`).subscribe({next:t=>{this.notificationService.showSuccess("Dispose item deleted successfully!","home")},error:t=>{this.notificationService.showError("Failed to delete dispose item","home"),this.signal_submitLoading.set(!1)},complete:()=>{this.signal_submitLoading.set(!1),this.action_status$.next("dispose"),this.stockService.getItems()}})}editDispose(e){this.signal_submitLoading.set(!0),this.http.put(`${this.api.host}/user-stock/dispose`,e).subscribe({next:t=>{this.notificationService.showSuccess("Dispose item updated successfully!","home")},error:t=>{this.notificationService.showError("Failed to update dispose item","home"),this.signal_submitLoading.set(!1)},complete:()=>{this.signal_submitLoading.set(!1),this.action_status$.next("dispose"),this.stockService.getItems()}})}getProducts(){return this.stockService.getProducts()}static{this.\u0275fac=function(t){return new(t||o)(g(U),g(K),g(Y),g(D))}}static{this.\u0275prov=V({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var Pe=["tableSearch"],Ie=()=>({width:"75vw"}),Te=()=>({"1199px":"85vw","575px":"95vw"}),Ee=()=>["product_name"],ke=()=>[10,15,50,100],Me=o=>({"text-red-500":o});function Ve(o,m){o&1&&(n(0,"tr")(1,"th",17),b(2,"p-tableHeaderCheckbox"),r(),n(3,"th",18),_(4," Description"),b(5,"p-sortIcon",19),r(),n(6,"th",20),_(7,"QTY"),r()())}function Fe(o,m){if(o&1){let e=C();n(0,"p-inputNumber",26),y("ngModelChange",function(i){p(e);let s=l().$implicit;return S(s.dispose_quantity,i)||(s.dispose_quantity=i),c(i)}),u("ngModelChange",function(){p(e);let i=l().$implicit,s=l(2);return c(s.setQty(i))})("onFocus",function(i){p(e);let s=l(3);return c(s.select(i.target))}),r()}if(o&2){let e=l().$implicit;w("ngModel",e.dispose_quantity)}}function Re(o,m){if(o&1&&(n(0,"span",27),_(1),r()),o&2){let e=l().$implicit,t=l(2);a("ngClass",Q(2,Me,t.error_rows.includes(e.product_id))),d(),E("",e.dispose_quantity||0," ")}}function qe(o,m){if(o&1&&(n(0,"tr",21)(1,"td"),b(2,"p-tableCheckbox",22),r(),n(3,"td"),_(4),r(),n(5,"td",23)(6,"p-cellEditor"),f(7,Fe,1,1,"ng-template",24)(8,Re,2,4,"ng-template",25),r()()()),o&2){let e=m.$implicit,t=m.rowIndex;a("pSelectableRow",e)("pSelectableRowIndex",t),d(2),a("pSelectableRow",e)("value",e),d(2),W(e.product_name),d(),a("pEditableColumn",e)}}function Le(o,m){o&1&&(n(0,"tr")(1,"td",28),_(2,"No items yet!"),r()())}function Oe(o,m){if(o&1){let e=C();n(0,"div",5)(1,"div",6)(2,"span",7),b(3,"i",8),n(4,"input",9,0),u("input",function(i){p(e);let s=T(12);return c(s.filterGlobal(i.target.value,"contains"))}),r()()(),n(6,"div",10)(7,"p-calendar",11),y("ngModelChange",function(i){p(e);let s=l();return S(s.dispose_date,i)||(s.dispose_date=i),c(i)}),r()(),n(8,"div",10)(9,"h3",12),_(10),r()()(),n(11,"p-table",13,1),y("selectionChange",function(i){p(e);let s=l();return S(s.selectedProducts,i)||(s.selectedProducts=i),c(i)}),u("onRowSelect",function(){p(e);let i=l();return c(i.selectInput())})("onRowUnselect",function(){p(e);let i=l();return c(i.selectInput())}),f(13,Ve,8,0,"ng-template",14)(14,qe,9,6,"ng-template",15)(15,Le,3,0,"ng-template",16),r()}if(o&2){let e=T(12),t=l();d(4),a("value",e.filters.global==null?null:e.filters.global.value),d(3),w("ngModel",t.dispose_date),a("showIcon",!1)("showClear",!1)("readonlyInput",!0),d(3),E(" Total Selected: ",t.selectedProducts.length," "),d(),a("value",t.cProducts),w("selection",t.selectedProducts),a("loading",t.tbl_loading())("globalFilterFields",x(16,Ee))("filterDelay",0)("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",x(17,ke))("alwaysShowPaginator",!0)}}function je(o,m){if(o&1){let e=C();n(0,"p-button",32),u("onClick",function(){p(e);let i=l(2);return c(i.deleteDispose())}),r()}if(o&2){let e=l(2);a("disabled",e.loading())}}function Ne(o,m){if(o&1){let e=C();f(0,je,1,1,"p-button",29),n(1,"p-button",30),u("onClick",function(){p(e);let i=l();return c(i.closeDialog())}),r(),n(2,"p-button",31),u("onClick",function(){p(e);let i=l();return c(i.dispose())}),r()}if(o&2){let e=l();a("ngIf",e.dialog_mode==="edit"),d(),a("disabled",e.loading()),d(),a("loading",e.loading())("disabled",e.selectedProducts.length==0)}}var bt=(()=>{class o{constructor(e,t,i,s){this.notificationsService=e,this.decimalService=t,this.disposeService=i,this.confirmationService=s,this.visible=!1,this.products=[],this.dialog_mode="add",this.onHide=new I,this.onSubmit=new I,this.subscriptions=new k,this.tbl_loading=this.disposeService.signal_products_loading,this.cProducts=structuredClone(this.disposeService.getProducts()()),this.selectedProducts=[],this.error_rows=[],this.dispose_date=new Date,this.loading=this.disposeService.signal_submitLoading}ngOnChanges(){this.visible&&this.products.length>0&&(this.cProducts=structuredClone(this.products)),this.visible&&this.dialog_mode==="edit"&&this.selected_dispose&&(this.cProducts=structuredClone(this.disposeService.getProducts()()),this.dispose_date=this.selected_dispose.dispose_date,this.selected_dispose.items.forEach(e=>{this.selectedProducts.push({product_id:e.product_id,dispose_quantity:e.quantity,unit_cost_usd:e.unit_cost});let t=this.cProducts.find(i=>i.product_id===e.product_id);t&&(t.dispose_quantity=e.quantity)}))}ngOnInit(){this.subscriptions.add(this.disposeService.action_status$.subscribe(e=>{e==="dispose"&&(this.initDialog(),this.onSubmit.emit(),this.disposeService.action_status$.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}initDialog(){this.selectedProducts=[],this.error_rows=[],this.dispose_date=new Date}closeDialog(){this.initDialog(),this.onHide.emit(!1)}dispose(){this.error_rows=[];let e=[],t=0,i=0;this.selectedProducts.forEach((s,v)=>{s.dispose_quantity?(e.push({product_id:s.product_id,unit_cost:s.unit_cost_usd,quantity:s.dispose_quantity}),t+=this.decimalService.multiply(parseFloat(s.unit_cost_usd),s.dispose_quantity),i+=s.dispose_quantity):this.error_rows.push(s.product_id)}),this.error_rows.length>0?this.notificationsService.showError("Set Quantity for all selected items","home"):this.dialog_mode==="add"?this.disposeService.disposeItems({info:{dispose_datetime:this.dispose_date,products_number:this.selectedProducts.length,total_count:i,total_cost:t},products:e}):this.disposeService.editDispose({info:{dispose_id:this.selected_dispose.dispose_id,dispose_datetime:this.dispose_date,products_number:this.selectedProducts.length,total_count:i,total_cost:t},products:e})}deleteDispose(){this.confirmationService.confirm({key:"home",message:"Are you sure that you want to delete dispose and return all items to stock ?",header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.disposeService.deleteDispose(this.selected_dispose.dispose_id)}})}setQty(e){let t=e.product_id;e.dispose_quantity?this.selectedProducts.includes(e)||(this.selectedProducts=[...this.selectedProducts,e]):this.selectedProducts=this.selectedProducts.filter(s=>s.product_id!==t)}selectInput(){this.tableSearch.nativeElement.select()}getError(e){return this.selectedProducts.includes(e)&&!e.dispose_quantity}select(e){e.select()}static{this.\u0275fac=function(t){return new(t||o)(h(D),h(de),h(ye),h(z))}}static{this.\u0275cmp=F({type:o,selectors:[["dispose-dialog"]],viewQuery:function(t,i){if(t&1&&O(Pe,5),t&2){let s;j(s=N())&&(i.tableSearch=s.first)}},inputs:{visible:"visible",products:"products",selected_dispose:"selected_dispose",dialog_mode:"dialog_mode"},outputs:{onHide:"onHide",onSubmit:"onSubmit"},standalone:!0,features:[R,B],decls:3,vars:10,consts:[["tableSearch",""],["dt",""],["position","top","header","Dispose Items","styleClass","p-fluid",3,"visibleChange","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[1,"grid","mb-2"],[1,"col-12","md:col-6"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","search","placeholder","Search ...",1,"p-inputtext-sm",3,"input","value"],[1,"col-6","md:col-3"],["styleClass","p-inputtext-sm w-full","appendTo","body","dateFormat","yy-mm-dd","placeholder","Date",3,"ngModelChange","ngModel","showIcon","showClear","readonlyInput"],[1,"text-center","m-0"],["selectionMode","multiple","dataKey","product_id","styleClass","p-datatable-sm","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} records",3,"selectionChange","onRowSelect","onRowUnselect","value","selection","loading","globalFilterFields","filterDelay","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[2,"width","3rem"],["pSortableColumn","product_name"],["field","product_name"],["width","20%"],[3,"pSelectableRow","pSelectableRowIndex"],[3,"pSelectableRow","value"],["pEditableColumnField","dispose_quantity",3,"pEditableColumn"],["pTemplate","input"],["pTemplate","output"],["min","0","step","0","size","1",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],[3,"ngClass"],["colspan","6"],["pRipple","","label","Delete","icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0",3,"disabled","onClick",4,"ngIf"],["pRipple","","label","Cancel","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","disabled"],["pRipple","","label","Finish","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","loading","disabled"],["pRipple","","label","Delete","icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0",3,"onClick","disabled"]],template:function(t,i){t&1&&(n(0,"p-dialog",2),y("visibleChange",function(v){return S(i.visible,v)||(i.visible=v),v}),f(1,Oe,16,18,"ng-template",3)(2,Ne,3,4,"ng-template",4),r()),t&2&&(L(x(8,Ie)),a("modal",!0),w("visible",i.visible),a("breakpoints",x(9,Te))("closeOnEscape",!1)("closable",!1)("maximizable",!0))},dependencies:[we,me,G,ue,ge,he,fe,_e,be,Ce,te,ee,re,ne,oe,ie,ae,le,Z,J,X,A,H,$,ce,pe],styles:[".editable[_ngcontent-%COMP%]{width:100%;height:28px}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}"]})}}return o})();export{bt as a};
