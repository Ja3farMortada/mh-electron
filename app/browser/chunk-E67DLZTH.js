import{b as u}from"./chunk-OWTGQR6U.js";import{a as d}from"./chunk-MB5UDTNQ.js";import{b as l,c as h}from"./chunk-SFMGPKFH.js";import{C as a,G as i,ha as s,zb as n}from"./chunk-E4UPHNBD.js";var L=(()=>{class o{constructor(){this.http=i(n),this.notificationService=i(l),this.api=i(h),this.socket=i(d),this.userService=i(u),this.tableLoading=s(!1),this.signal_submitLoading=s(!1),this.signal_itemDialogVisible=s(!1),this.signal_submitted=s(!1),this.selectedItem=s(null),this.products=s([]),this.userType=this.userService.userType,this.loggedInUser=this.userService.loggedInUser,this.first_run=!0,this.socket.on("productUpdated",t=>{this.getItems()})}getItems(){this.tableLoading.set(!0),this.http.get(`${this.api.host}/user-stock`).subscribe({next:t=>{this.products.set(t)},error:t=>{this.notificationService.handleError(t.error,"home"),this.tableLoading.set(!1)},complete:()=>{this.tableLoading.set(!1)}})}getProducts(t=!1){return t||this.first_run?(this.getItems(),this.first_run=!1,console.log("fetch products from server")):console.log("fetch products from local storage"),this.products}updateItem(t){this.signal_submitLoading.set(!0),this.http.put(`${this.api.host}/user-stock/${t.product_id}`,t).subscribe({next:e=>{console.log(e),this.products.update(r=>{let c=this.products().findIndex(p=>p.product_id===t.product_id);return[...r.slice(0,c),e,...r.slice(c+1)]}),this.selectedItem.set(e),this.notificationService.showSuccess("Product updated successfully!")},error:e=>{this.notificationService.handleError(e,"home"),this.signal_submitLoading.set(!1)},complete:()=>{this.signal_itemDialogVisible.set(!1),this.signal_submitLoading.set(!1)}})}autoUpdateProduct(){}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{L as a};
